---
title: MySQL50-11-ç¬¬41-45é¢˜
top: false
cover: false
toc: true
mathjax: true
copyright: true
date: 2020-11-22 10:06:53
password:
summary:
tags:
  - æ•°æ®åº“
  - MySQL
categories:
  - MySQL
  - 50é¢˜
---

### MySQL50-11-ç¬¬41-45é¢˜

æœ¬æ–‡ä¸­ä»‹ç»çš„æ˜¯ç¬¬41-45é¢˜ï¼Œä¸»è¦åŒ…å«çš„çŸ¥è¯†ç‚¹ï¼š

- è¡¨çš„è‡ªè¿æ¥æŸ¥è¯¢æ¯”è¾ƒä¿¡æ¯
- æ‰¾å‡ºå‰2å
- åˆ†ç»„æ’åº+having è¿‡æ»¤

5ä¸ªé¢˜ç›®æ˜¯

- æŸ¥è¯¢ä¸åŒè¯¾ç¨‹æˆç»©ç›¸åŒçš„å­¦ç”Ÿçš„å­¦ç”Ÿç¼–å·ã€è¯¾ç¨‹ç¼–å·ã€å­¦ç”Ÿæˆç»©
- æ¯é—¨åŠŸè¯¾æœ€å¥½çš„å‰2å
- ç»Ÿè®¡æ¯é—¨è¯¾ç¨‹çš„å­¦ç”Ÿé€‰ä¿®äººæ•°ï¼ˆè¶…è¿‡5äººçš„è¯¾ç¨‹æ‰ç»Ÿè®¡ï¼‰ã€‚è¦æ±‚è¾“å‡ºè¯¾ç¨‹å·å’Œé€‰ä¿®äººæ•°ï¼ŒæŸ¥è¯¢ç»“æœæŒ‰äººæ•°é™åºæ’åˆ—ï¼Œè‹¥äººæ•°ç›¸åŒï¼ŒæŒ‰è¯¾ç¨‹å·å‡åºæ’åˆ—
- æ£€ç´¢è‡³å°‘é€‰ä¿®ä¸¤é—¨è¯¾ç¨‹çš„å­¦ç”Ÿå­¦å·
- æŸ¥è¯¢é€‰ä¿®äº†å…¨éƒ¨è¯¾ç¨‹çš„å­¦ç”Ÿä¿¡æ¯

![](https://tva1.sinaimg.cn/large/0081Kckwgy1gkx2kmpg4yj31y70u0k14.jpg)

<!--MORE-->

### é¢˜ç›®41

#### é¢˜ç›®éœ€æ±‚

æŸ¥è¯¢ä¸åŒè¯¾ç¨‹æˆç»©ç›¸åŒçš„å­¦ç”Ÿçš„å­¦ç”Ÿç¼–å·ã€è¯¾ç¨‹ç¼–å·ã€å­¦ç”Ÿæˆç»©

#### åˆ†æè¿‡ç¨‹

- è¯¾ç¨‹æˆç»©ï¼šScoreï¼Œs_score
- å­¦ç”Ÿç¼–å·ï¼šScoreï¼Œs_id
- è¯¾ç¨‹ç¼–å·ï¼šScoreï¼Œc_id

3ä¸ªå­—æ®µåŒæ—¶åœ¨ä¸€ä¸ªè¡¨ä¸­ï¼Œæ‰€ä»¥æˆ‘ä»¬å¯ä»¥é€šè¿‡ä¸€ä¸ª**è¡¨Scoreçš„è‡ªè¿æ¥**æ¥å®ç°æŸ¥å‡º

#### SQLå®ç°

```sql
select
	a.s_id
	,a.c_id
	,a.s_score
from Score a
join Score b
on a.c_id != b.c_id
and a.s_score = b.s_score
and a.s_id != b.s_id;
```

![](https://tva1.sinaimg.cn/large/0081Kckwgy1gkx901q3h2j30pi0lcjt2.jpg)

æˆ‘ä»¬å¯¹å­¦å·è¿˜éœ€è¦å»é‡ä¸‹ï¼š

```sql
select
	distinct a.s_id
	,a.c_id
	,a.s_score
from Score a
join Score b
on a.c_id != b.c_id
and a.s_score = b.s_score
and a.s_id != b.s_id;
```

![](https://tva1.sinaimg.cn/large/0081Kckwgy1gkx90x1us9j30pg0kq0uc.jpg)

å†çœ‹çœ‹åŸå§‹çš„æ•°æ®ä¸­æ˜¯å¦ç¬¦åˆè¦æ±‚ï¼š

![](https://tva1.sinaimg.cn/large/0081Kckwgy1gkx936d7e2j30ku0qy40e.jpg)



### é¢˜ç›®42

#### é¢˜ç›®éœ€æ±‚

æŸ¥è¯¢æ¯é—¨åŠŸæˆç»©æœ€å¥½çš„å‰ä¸¤å

#### åˆ†æè¿‡ç¨‹

é¢˜ç›®çš„è¦æ±‚å°±æ˜¯æ‰¾å‡ºæ¯é—¨è¯¾çš„å‰2ååŒå­¦

- æˆç»©ï¼šScore
- å­¦ç§‘ï¼šCourse

#### SQLå®ç°

##### è‡ªå·±çš„æ–¹æ³•

è¿˜éœ€è¦å¥½å¥½ä¼˜åŒ–çš„ğŸ˜­

```sql
-- å…ˆæ‰¾å‡ºè¯­æ–‡çš„å‰2ååŒå­¦

select
	c.c_id
	,sc.s_id
	,sc.s_score
from Score sc
join Course c
on sc.c_id = c.c_id
where c.c_name = 'è¯­æ–‡'   -- æ”¹æˆæ•°å­¦å’Œè‹±è¯­å³å¯æ±‚å‡ºç›¸åº”çš„ä¿¡æ¯
order by sc.s_score desc
limit 2;
```

![](https://tva1.sinaimg.cn/large/0081Kckwgy1gkx9dv5ttmj30z40k8ac2.jpg)

å°†3é—¨å­¦ç§‘çš„ä¿¡æ¯è¿›è¡Œæ‹¼æ¥å³å¯æ±‚å‡ºç­”æ¡ˆï¼š

```sql
-- æœ€ç»ˆè„šæœ¬

(select
	c.c_id
	,sc.s_id
	,sc.s_score
from Score sc
join Course c
on sc.c_id = c.c_id
where c.c_name = 'è¯­æ–‡'
order by sc.s_score desc
limit 2)

union

(select
	c.c_id
	,sc.s_id
	,sc.s_score
from Score sc
join Course c
on sc.c_id = c.c_id
where c.c_name = 'æ•°å­¦'
order by sc.s_score desc
limit 2)

union

(select
	c.c_id
	,sc.s_id
	,sc.s_score
from Score sc
join Course c
on sc.c_id = c.c_id
where c.c_name = 'è‹±è¯­'
order by sc.s_score desc
limit 2)
```

![](https://tva1.sinaimg.cn/large/0081Kckwgy1gkx9gmhjx3j30hw0di750.jpg)



##### å‚è€ƒæ–¹æ³•ï¼ˆå¥½æ–¹æ³•ï¼‰

å¦‚ä½•è§£å†³å‰å‡ åæ’åºçš„é—®é¢˜ğŸ‚ğŸºğŸš—å¤ªç‰›äº†

```sql
select
	a.c_id
	,a.s_id
	,a.s_score
from Score a
where (select count(1)   -- count(1)ç±»ä¼¼count(*)ï¼šç»Ÿè®¡è¡¨bä¸­åˆ†æ•°å¤§çš„æ•°é‡
       from Score b
       where b.c_id=a.c_id   -- è¯¾ç¨‹ç›¸åŒ
       and b.s_score >= a.s_score) <= 2   -- å‰2å
order by a.c_id;
```

![](https://tva1.sinaimg.cn/large/0081Kckwgy1gkx9l1mwhyj31ey0l6gns.jpg)

é¦–å…ˆæˆ‘ä»¬çœ‹çœ‹çœŸå®çš„æ•°æ®ï¼Œæˆ‘ä»¬ä»¥01è¯¾ç¨‹æ¥è¿›è¡Œè§£é‡Šä¸Šé¢çš„ä»£ç ï¼š

![](https://tva1.sinaimg.cn/large/0081Kckwgy1gkxogq99jpj318o0f2402.jpg)

ç¬¦åˆè¦æ±‚`count(1)<=2`çš„åªæœ‰ä¸¤ç§æƒ…å†µ

![](https://tva1.sinaimg.cn/large/0081Kckwgy1gkxo68apdvj30za0sqgo1.jpg)

è¿˜éœ€è¦å¥½å¥½ç†è§£ä¸‹ğŸ˜­



### é¢˜ç›®43

![](https://tva1.sinaimg.cn/large/0081Kckwgy1gkx2kmpg4yj31y70u0k14.jpg)

#### é¢˜ç›®éœ€æ±‚

ç»Ÿè®¡æ¯é—¨è¯¾ç¨‹çš„å­¦ç”Ÿé€‰ä¿®äººæ•°ï¼ˆè¶…è¿‡5äººçš„è¯¾ç¨‹æ‰ç»Ÿè®¡ï¼‰ã€‚è¦æ±‚è¾“å‡ºè¯¾ç¨‹å·å’Œé€‰ä¿®äººæ•°ï¼ŒæŸ¥è¯¢ç»“æœæŒ‰äººæ•°é™åºæ’åˆ—ï¼Œè‹¥äººæ•°ç›¸åŒï¼ŒæŒ‰è¯¾ç¨‹å·å‡åºæ’åˆ—

#### åˆ†æè¿‡ç¨‹

è¯¾ç¨‹å·ï¼šScoreï¼Œc_id

å­¦ç”Ÿï¼šScoreï¼Œs_id

#### SQLå®ç°

```sql
select
	c_id
	,count(s_score) num
from Score
group by c_id
having num > 5
order by num desc, c_id;
```

![](https://tva1.sinaimg.cn/large/0081Kckwgy1gkxpfmw48rj30n20hs3zz.jpg)



### é¢˜ç›®44

#### é¢˜ç›®éœ€æ±‚

æ£€ç´¢è‡³å°‘é€‰ä¿®ä¸¤é—¨è¯¾ç¨‹çš„å­¦ç”Ÿå­¦å·

#### åˆ†æè¿‡ç¨‹

è¯¾ç¨‹ï¼šScoreï¼Œc_id

å­¦å·ï¼šScoreï¼Œs_id

#### SQLå®ç°

ç»“æœæ˜¾ç¤ºå…¨éƒ¨æ»¡è¶³è¦æ±‚

```sql
select
	s_id
	,count(*) num
from Score
group by s_id
having num >= 2;
```

![](https://tva1.sinaimg.cn/large/0081Kckwgy1gkxpkjduwjj30ie0logmv.jpg)



### é¢˜ç›®45

#### é¢˜ç›®éœ€æ±‚

æŸ¥è¯¢é€‰ä¿®äº†å…¨éƒ¨è¯¾ç¨‹çš„å­¦ç”Ÿä¿¡æ¯

#### åˆ†æè¿‡ç¨‹

1. é¦–å…ˆæˆ‘ä»¬åœ¨Courseè¡¨çœ‹çœ‹å…¨éƒ¨è¯¾ç¨‹æ•°ç›®æ˜¯å¤šå°‘(num)
2. ç„¶ååœ¨Scoreè¡¨ä¸­æ‰¾å‡ºè¯¾ç¨‹æ˜¯numçš„å­¦ç”Ÿä¿¡æ¯

#### SQLå®ç°

#### è‡ªå·±çš„æ–¹æ³•

1ã€å…¨éƒ¨çš„è¯¾ç¨‹æ•°ç›®num

```sql
select count(*) from Course;   -- æ€»å…±3é—¨
```

![image-20201122095253954](https://tva1.sinaimg.cn/large/0081Kckwgy1gkxpq1e557j30jk08ijrs.jpg)

2ã€ä»Scoreè¡¨åˆ†ç»„ç»Ÿè®¡æ¯ä¸ªäººçš„è¯¾ç¨‹æ•°ç›®ï¼Œæ»¡è¶³æ˜¯3çš„å­¦ç”Ÿä¿¡æ¯

```sql
select
	s_id
	,count(c_id) num   -- è¯¾ç¨‹æ•°ç›®
from Score
group by s_id
having num in (select count(*)
               from Course); --æ»¡è¶³å…¨éƒ¨è¯¾ç¨‹
```

![](https://tva1.sinaimg.cn/large/0081Kckwgy1gkxputtukdj30sk0iywg6.jpg)

3ã€æˆ‘ä»¬æ‰¾å‡ºä¸Šé¢ç»“æœä¸­çš„å­¦ç”Ÿä¿¡æ¯å³å¯

```sql
select
	s.*
	,count(c_id) num   -- è¯¾ç¨‹æ•°ç›®
from Score sc
join Student s
on sc.s_id = s.s_id
group by s.s_id
having num in (select count(*)
               from Course); --æ»¡è¶³å…¨éƒ¨è¯¾ç¨‹
```

![](https://tva1.sinaimg.cn/large/0081Kckwgy1gkxpybx2k4j30sk0lkgo7.jpg)

##### å‚è€ƒæ–¹æ³•

```sql
select *   -- 3ã€s_idå¯¹åº”çš„å­¦ç”Ÿä¿¡æ¯
from Student
where s_id in(select s_id -- 2ã€æœ€å¤§è¯¾ç¨‹æ•°å¯¹åº”çš„s_id
              from Score
              group by s_id
              having count(*)=(select count(*) from Course)  -- 1ã€å…¨éƒ¨è¯¾ç¨‹æ•°
             )
```


