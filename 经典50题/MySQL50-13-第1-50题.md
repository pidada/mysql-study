### MySQLç»å…¸50é¢˜

MySQLç»å…¸50é¢˜çš„ä¹ é¢˜åŠå‚è€ƒç­”æ¡ˆğŸ’ª



![](https://tva1.sinaimg.cn/large/0081Kckwgy1gkxwr7bq7pj31y00u0wo8.jpg)

<!--MORE-->

### é¢˜ç›®1

#### é¢˜ç›®è¦æ±‚

æŸ¥è¯¢"01"è¯¾ç¨‹æ¯”"02"è¯¾ç¨‹**æˆç»©é«˜**çš„å­¦ç”Ÿçš„ä¿¡æ¯åŠè¯¾ç¨‹åˆ†æ•°

#### SQLå®ç°



```mysql
-- æ–¹æ³•1
select 
	a.*
	,b.s_score as 1_score   
	,c.s_score as 2_score
from Student a
join Score b on a.s_id = b.s_id  and b.c_id = '01'   -- ä¸¤ä¸ªè¡¨é€šè¿‡å­¦å·è¿æ¥ï¼ŒæŒ‡å®š01
left join Score c on a.s_id = c.s_id and c.c_id='02' or c.c_id is NULL -- æŒ‡å®š02ï¼Œæˆ–è€…cä¸­çš„c_idç›´æ¥ä¸å­˜åœ¨
-- ä¸ºNULLçš„æ¡ä»¶å¯ä»¥ä¸å­˜åœ¨ï¼Œå› ä¸ºå·¦è¿æ¥ä¸­ä¼šç›´æ¥æ’é™¤cè¡¨ä¸­ä¸å­˜åœ¨çš„æ•°æ®ï¼ŒåŒ…å«NULL
where b.s_score > c.s_score;   -- åˆ¤æ–­æ¡ä»¶


-- æ–¹æ³•2ï¼šç›´æ¥ä½¿ç”¨whereè¯­å¥
select 
	a.*
	,b.s_score as 1_score
	,c.s_score as 2_score
from Student a, Score b, Score c
where a.s_id=b.s_id   -- åˆ—å‡ºå…¨éƒ¨çš„æ¡ä»¶
and a.s_id=c.s_id
and b.c_id='01'
and c.c_id='02'
and b.s_score > c.s_score;   -- å‰è€…æˆç»©é«˜
```

![](https://tva1.sinaimg.cn/large/0081Kckwgy1gk8b40swzkj313g0ou42k.jpg)



**ç¬¬äºŒç§æ–¹æ³•å®ç°**ï¼š

![](https://tva1.sinaimg.cn/large/0081Kckwgy1gk8b6h6ycgj30yq0modir.jpg)



![](https://tva1.sinaimg.cn/large/0081Kckwgy1gk8b56rmndj30im0su76f.jpg)



### é¢˜ç›®2

#### é¢˜ç›®è¦æ±‚

æŸ¥è¯¢"01"è¯¾ç¨‹æ¯”"02"è¯¾ç¨‹**æˆç»©ä½**çš„å­¦ç”Ÿçš„ä¿¡æ¯åŠè¯¾ç¨‹åˆ†æ•°ï¼ˆé¢˜ç›®1æ˜¯æˆç»©é«˜ï¼‰

#### SQLå®ç°

ç±»æ¯”é¢˜ç›®1çš„å®ç°è¿‡ç¨‹

```mysql
-- æ–¹æ³•1ï¼šé€šè¿‡è¿æ¥æ–¹å¼å®ç°
select 
	a.*
	,b.s_score as 1_score
	,c.s_score as 2_score 
from Student a
left join Score b on a.s_id=b.s_id and b.c_id='01' or b.c_id=NULL   -- åŒ…å«NULLçš„æ•°æ®
join score c on a.s_id=c.s_id and c.c_id='02' 
where b.s_score < c.s_score;

-- é€šè¿‡whereå­å¥å®ç°
select 
	a.*
	,b.s_score as 1_score
	,c.s_score as 2_score
from Student a, Score b, Score c
where a.s_id=b.s_id
and a.s_id=c.s_id
and b.c_id='01'
and c.c_id='02'
and b.s_score < c.s_score;   -- å‰è€…æ¯”è¾ƒå°
```

### é¢˜ç›®3

#### é¢˜ç›®éœ€æ±‚

æŸ¥è¯¢å¹³å‡æˆç»©å¤§äºç­‰äº60åˆ†çš„åŒå­¦çš„å­¦ç”Ÿç¼–å·å’Œå­¦ç”Ÿå§“åå’Œå¹³å‡æˆç»©

#### SQLå®ç°

```mysql
-- æ‰§è¡Œé¡ºåºï¼šå…ˆæ‰§è¡Œåˆ†ç»„ï¼Œå†æ‰§è¡Œavgå¹³å‡æ“ä½œ
select 
	b.s_id
	,b.s_name
	,round(avg(a.s_score), 2) as avg_score
from Student b
join Score a
on b.s_id = a.s_id
group by b.s_id   -- åˆ†ç»„ä¹‹åæŸ¥è¯¢æ¯ä¸ªäººçš„å¹³å‡æˆç»©
having avg_score >= 60;

-- é™„åŠ é¢˜ï¼šæ€»åˆ†è¶…è¿‡200åˆ†çš„åŒå­¦
select 
	b.s_id
	,b.s_name
	,round(sum(a.s_score),2) as sum_score    -- sumæ±‚å’Œ
from Student b 
join Score a 
on b.s_id=a.s_id 
group by b.s_id 
having sum_score > 200;
```



![](https://tva1.sinaimg.cn/large/0081Kckwgy1gk8usp5ynyj31380j6tpk.jpg)



é™„åŠ é¢˜ï¼šæ€»åˆ†è¶…è¿‡200åˆ†çš„åŒå­¦

![](https://tva1.sinaimg.cn/large/0081Kckwgy1gk8v56w77aj30z60lqdus.jpg)

### é¢˜ç›®4

#### é¢˜ç›®è¦æ±‚

æŸ¥è¯¢å¹³å‡æˆç»©å°äº60åˆ†çš„åŒå­¦çš„å­¦ç”Ÿç¼–å·å’Œå­¦ç”Ÿå§“åå’Œå¹³å‡æˆç»©ï¼ˆåŒ…æ‹¬æœ‰æˆç»©çš„å’Œæ— æˆç»©çš„ï¼‰

#### SQLå®ç°1-ä¸¤ç§æƒ…å†µè¿æ¥

å¹³å‡åˆ†å°äº60

```mysql
select 
	b.s_id
	,b.s_name
	,round(avg(a.s_score), 2) as avg_score   -- roundå››èˆäº”å…¥å‡½æ•°
from Student b
join Score a
on b.s_id = a.s_id
group by b.s_id   -- åˆ†ç»„ä¹‹åæŸ¥è¯¢æ¯ä¸ªäººçš„å¹³å‡æˆç»©
having avg_score < 60;
```

ç»“æœä¸ºï¼š

![](https://tva1.sinaimg.cn/large/0081Kckwgy1gk8vx5qmksj312u0l4mzy.jpg)

æ²¡æœ‰æˆç»©çš„åŒå­¦ï¼š

```mysql
select 
	a.s_id
	,a.s_name
	,0 as avg_score
from Student a
where a.s_id not in (  -- å­¦ç”Ÿçš„å­¦å·ä¸åœ¨ç»™ç»™å®šè¡¨çš„å­¦å·ä¸­
  select distinct s_id -- æŸ¥è¯¢å‡ºå…¨éƒ¨çš„å­¦å·
  from Score   
);
```

![image-20201031222540647](https://tva1.sinaimg.cn/large/0081Kckwgy1gk8vujszezj30s00i2acb.jpg)

![](https://tva1.sinaimg.cn/large/0081Kckwgy1gk8vwc1520j30r00vemzv.jpg)

æœ€åå°†ä¸¤ä¸ªéƒ¨åˆ†çš„ç»“æœè¿èµ·æ¥å³å¯ï¼šé€šè¿‡`union`æ–¹æ³•

![](https://tva1.sinaimg.cn/large/0081Kckwgy1gk8vzk013ej30xy0u0jwb.jpg)

#### SQLå®ç°2-ifnullå‡½æ•°åˆ¤æ–­

ä½¿ç”¨ifnullå‡½æ•°

```mysql
select 
	S.s_id
	,S.s_name
	,round(avg(ifnull(C.s_score,0)), 2) as avg_score   -- ifnull å‡½æ•°ï¼šç¬¬ä¸€ä¸ªå‚æ•°å­˜åœ¨åˆ™å–å®ƒæœ¬èº«ï¼Œä¸å­˜åœ¨å–ç¬¬äºŒä¸ªå€¼0
from Student S
left join Score C
on S.s_id = C.s_id
group by s_id
having avg_score < 60;
```

ä½¿ç”¨nullåˆ¤æ–­

```mysql
select 
	a.s_id
	,a.s_name
	,ROUND(AVG(b.s_score), 2) as avg_score 
from Student a 
left join Score b on a.s_id = b.s_id 
GROUP BY a.s_id 
HAVING avg_score < 60 or avg_score is null;   -- æœ€åçš„NULLåˆ¤æ–­
```

### é¢˜ç›®5

#### é¢˜ç›®éœ€æ±‚

æŸ¥è¯¢æ‰€æœ‰åŒå­¦çš„å­¦ç”Ÿç¼–å·ã€å­¦ç”Ÿå§“åã€é€‰è¯¾æ€»æ•°ã€æ‰€æœ‰è¯¾ç¨‹çš„æ€»æˆç»©

#### SQLå®ç°

```sql
select 
	a.s_id
	,a.s_name
	,count(b.c_id) as course_number   -- è¯¾ç¨‹ä¸ªæ•°
	,sum(b.s_score) as scores_sum  -- æˆç»©æ€»å’Œ
from Student a
left join Score b
on a.s_id = b.s_id
group by a.s_id,a.s_name;
```



![](https://tva1.sinaimg.cn/large/0081Kckwgy1gk8wgqh89fj30ve0ssq68.jpg)



### é¢˜ç›®6

#### é¢˜ç›®éœ€æ±‚

æŸ¥è¯¢â€œæâ€å§“è€å¸ˆçš„æ•°é‡

#### SQLå®ç°

```sql
select count(t_name) from Teacher where t_name like "æ%";   -- é€šé…ç¬¦
```

![](https://tva1.sinaimg.cn/large/0081Kckwgy1gkfy1jqoh1j312g0mi4ew.jpg)

è¿™é¢˜æ€•æ˜¯æœ€ç®€å•çš„å§ğŸ˜­



### é¢˜ç›®7

![](https://tva1.sinaimg.cn/large/0081Kckwgy1gkfykg7iirj319y0hytcr.jpg)

#### é¢˜ç›®éœ€æ±‚

æŸ¥è¯¢å­¦è¿‡**å¼ ä¸‰è€å¸ˆ**æˆè¯¾çš„åŒå­¦çš„ä¿¡æ¯

#### SQLå®ç°

```sql
-- æ–¹æ³•1ï¼šé€šè¿‡å¼ ä¸‰è€å¸ˆçš„è¯¾ç¨‹çš„å­¦ç”Ÿæ¥æŸ¥æ‰¾ï¼›è‡ªå·±çš„æ–¹æ³•
select * -- 3. é€šè¿‡å­¦å·æ‰¾å‡ºå…¨éƒ¨å­¦ç”Ÿä¿¡æ¯
from Student
where s_id in (
  select s_id    -- 2.é€šè¿‡è¯¾ç¨‹æ‰¾å‡ºå¯¹åº”çš„å­¦å·
  from Score  S
  join Course C
  on S.c_id = C.c_id  -- è¯¾ç¨‹è¡¨å’Œæˆç»©è¡¨
  where C.t_id=(select t_id from Teacher where t_name="å¼ ä¸‰")  -- 1.æŸ¥è¯¢å¼ ä¸‰è€å¸ˆçš„è¯¾ç¨‹
);

-- æ–¹æ³•2ï¼šé€šè¿‡å¼ ä¸‰è€å¸ˆçš„è¯¾ç¨‹æ¥æŸ¥è¯¢
select s1.* 
from Student s1
join Score s2 
on s1.s_id=s2.s_id 
where s2.c_id in (
  select c_id from Course c where t_id=(  -- 1. é€šè¿‡è€å¸ˆæ‰¾å‡ºå…¶å¯¹åº”çš„è¯¾ç¨‹
    select t_id from Teacher t where t_name="å¼ ä¸‰"
  )
)

-- æ–¹æ³•3
select s.* from Teacher t
left join Course c on t.t_id=c.t_id  -- æ•™å¸ˆè¡¨å’Œè¯¾ç¨‹è¡¨
left join Score sc on c.c_id=sc.c_id  -- è¯¾ç¨‹è¡¨å’Œæˆç»©è¡¨
left join Student s on s.s_id=sc.s_id  -- æˆç»©è¡¨å’Œå­¦ç”Ÿä¿¡æ¯è¡¨
where t.t_name='å¼ ä¸‰';
```

è‡ªå·±çš„æ–¹æ³•ï¼š

![](https://tva1.sinaimg.cn/large/0081Kckwgy1gkfyw8cji2j31hu0pmwir.jpg)

æ–¹æ³•2æ¥å®ç°ï¼š

![](https://tva1.sinaimg.cn/large/0081Kckwgy1gkgfe6f95qj319a0rywif.jpg)

æ–¹æ³•3å®ç°ï¼š

![](https://tva1.sinaimg.cn/large/0081Kckwgy1gkglhqi59wj30sq0luqeo.jpg)

### é¢˜ç›®8

#### é¢˜ç›®éœ€æ±‚

æ‰¾å‡ºæ²¡æœ‰å­¦è¿‡å¼ ä¸‰è€å¸ˆè¯¾ç¨‹çš„å­¦ç”Ÿ

#### SQLå®ç°

```sql
select * -- 3. é€šè¿‡å­¦å·æ‰¾å‡ºå…¨éƒ¨å­¦ç”Ÿä¿¡æ¯
from Student
where s_id not in (  -- 2.é€šè¿‡å­¦å·å–åï¼šå­¦å·ä¸åœ¨å¼ ä¸‰è€å¸ˆæˆè¯¾çš„å­¦ç”Ÿçš„å­¦å·ä¸­
  select s_id    
  from Score  S
  join Course C
  on S.c_id = C.c_id
  where C.t_id=(select t_id from Teacher where t_name ="å¼ ä¸‰")  -- 1.æŸ¥è¯¢å¼ ä¸‰è€å¸ˆçš„è¯¾ç¨‹
);

-- æ–¹æ³•2ï¼š
select * 
from Student s1
where s1.s_id not in (
  select s2.s_id from Student s2 join Score s3 on s2.s_id=s3.s_id where s3.c_id in(
    select c.c_id from Course c join Teacher t on c.t_id=t.t_id where t_name="å¼ ä¸‰" 
  )
);

-- æ–¹æ³•3
select s1.* 
from Student s1
join Score s2 
on s1.s_id=s2.s_id 
where s2.c_id not in (
  select c_id from Course c where t_id=(  -- 1. é€šè¿‡è€å¸ˆæ‰¾å‡ºå…¶å¯¹åº”çš„è¯¾ç¨‹
    select t_id from Teacher t where t_name="å¼ ä¸‰"
  )
);
```

![](https://tva1.sinaimg.cn/large/0081Kckwgy1gkfz017sdkj31hw0lsn0o.jpg)

æ–¹æ³•2ï¼š

![](https://tva1.sinaimg.cn/large/0081Kckwgy1gkgflt57luj31fg0im0v6.jpg)

### é¢˜ç›®9

#### é¢˜ç›®éœ€æ±‚

æŸ¥è¯¢å­¦è¿‡ç¼–å·ä¸º01ï¼Œ**å¹¶ä¸”å­¦è¿‡**ç¼–å·ä¸º02è¯¾ç¨‹çš„å­¦ç”Ÿä¿¡æ¯

#### SQLå®ç°

```mysql
-- è‡ªå·±çš„æ–¹æ³•ï¼šé€šè¿‡è‡ªè¿æ¥å®ç°
select s1.*
from Student s1
where s_id in (
  select s2.s_id from Score s2
  join Score s3
  on s2.s_id=s3.s_id
  where s2.c_id='01' and s3.c_id='02'
);

-- æ–¹æ³•2ï¼šç›´æ¥é€šè¿‡whereè¯­å¥å®ç°
select s1.*
from Student s1, Score s2, Score s3
where s1.s_id=s2.s_id 
and s1.s_id=s3.s_id
and s2.c_id=01 and s3.c_id=02;

-- æ–¹æ³•3ï¼šä¸¤ä¸ªå­æŸ¥è¯¢
-- 1. å…ˆæŸ¥å‡ºå­¦å·
select sc1.s_id
from (select * from Score s1 where s1.c_id='01') sc1,
			(select * from Score s1 where s1.c_id='02') sc2
where sc1.s_id=sc2.s_id;

-- 2.æ‰¾å‡ºå­¦ç”Ÿä¿¡æ¯
select * 
from Student 
where s_id in (select sc1.s_id   -- æŒ‡å®šå­¦å·æ˜¯ç¬¦åˆè¦æ±‚çš„
               from (select * from Score s1 where s1.c_id='01') sc1,
               (select * from Score s1 where s1.c_id='02') sc2
where sc1.s_id=sc2.s_id);
```

1. å…ˆä»Scoreè¡¨ä¸­çœ‹çœ‹å“ªäº›äººæ˜¯æ»¡è¶³è¦æ±‚çš„ï¼š**01-05åŒå­¦æ˜¯æ»¡è¶³çš„**

![](https://tva1.sinaimg.cn/large/0081Kckwgy1gkgfvak2fbj30iw0v6dib.jpg)

é€šè¿‡è‡ªè¿æ¥æŸ¥è¯¢çš„è¯­å¥å¦‚ä¸‹ï¼š

![](https://tva1.sinaimg.cn/large/0081Kckwgy1gkggbtl1qgj30qg0iwq49.jpg)

æŸ¥è¯¢å‡ºå­¦å·åå†åŒ¹é…å‡ºå­¦ç”Ÿä¿¡æ¯ï¼š

![](https://tva1.sinaimg.cn/large/0081Kckwgy1gkggd4ze5bj30s80okdio.jpg)

é€šè¿‡whereè¯­å¥å®ç°ï¼š

![](https://tva1.sinaimg.cn/large/0081Kckwgy1gkggjw0wggj30ua0jyq5e.jpg)

æ–¹æ³•3çš„å®ç°ï¼š

![](https://tva1.sinaimg.cn/large/0081Kckwgy1gkgjv0qrhtj316e0lmjuk.jpg)



### é¢˜ç›®10

#### é¢˜ç›®éœ€æ±‚

æŸ¥è¯¢å­¦è¿‡01è¯¾ç¨‹ï¼Œ**ä½†æ˜¯æ²¡æœ‰å­¦è¿‡02**è¯¾ç¨‹çš„å­¦ç”Ÿä¿¡æ¯ï¼ˆæ³¨æ„å’Œä¸Šé¢ğŸ‘†é¢˜ç›®çš„åŒºåˆ«ï¼‰

#### SQLå®ç°

é¦–å…ˆçœ‹çœ‹å“ªäº›åŒå­¦æ˜¯æ»¡è¶³è¦æ±‚çš„ï¼šåªæœ‰06å·åŒå­¦æ˜¯æ»¡è¶³çš„

![](https://tva1.sinaimg.cn/large/0081Kckwgy1gkggl91cb0j30k40wcq57.jpg)

##### é”™è¯¯æ€è·¯1

ç›´æ¥å°†ä¸Šé¢ä¸€é¢˜çš„ç»“æœå…¨éƒ¨æ’å‡ºï¼Œå¯¼è‡´é‚£äº›æ²¡æœ‰å­¦è¿‡01è¯¾ç¨‹çš„å­¦ç”Ÿä¹Ÿå‡ºç°äº†ï¼š07ï¼Œ08

```sql
select s1.*
from Student s1
where s_id not in (   -- ç›´æ¥å°†ä¸Šé¢ä¸€é¢˜çš„ç»“æœå…¨éƒ¨æ’å‡ºï¼Œå¯¼è‡´é‚£äº›æ²¡æœ‰å­¦è¿‡01è¯¾ç¨‹çš„å­¦ç”Ÿä¹Ÿå‡ºç°äº†ï¼š07ï¼Œ08
  select s2.s_id from Score s2
  join Score s3
  on s2.s_id=s3.s_id
  where s2.c_id='01' and s3.c_id ='02'
);
```

![](https://tva1.sinaimg.cn/large/0081Kckwgy1gkggsz5r1kj30pu0l4acc.jpg)

##### é”™è¯¯æ€è·¯2

å°†ä¸Šé¢é¢˜ç›®ä¸­çš„02è¯¾ç¨‹ç›´æ¥å–åï¼Œå¯¼è‡´åŒæ—¶ä¿®è¿‡01ï¼Œ02ï¼Œ03æˆ–è€…åªä¿®01ï¼Œ03çš„åŒå­¦ä¹Ÿä¼šå‡ºç°

```sql
select s1.*
from Student s1
where s_id in (
  select s2.s_id from Score s2
  join Score s3
  on s2.s_id=s3.s_id
  where s2.c_id='01' and s3.c_id !='02'   -- ç›´æ¥å–åæ˜¯ä¸è¡Œçš„ï¼Œå› ä¸ºä¿®æ”¹(01,02,03)çš„åŒå­¦ä¹Ÿä¼šå‡ºç°
);
```

![](https://tva1.sinaimg.cn/large/0081Kckwgy1gkgilmvzi8j31mk0pm78m.jpg)

##### æ­£ç¡®æ€è·¯

https://www.jianshu.com/p/9abffdd334fa

```sql
-- æ–¹æ³•1ï¼šæ ¹æ®ä¸¤ç§ä¿®è¯¾æƒ…å†µæ¥åˆ¤æ–­

select s1.* 
from Student s1
where s1.s_id in (select s_id from Score where c_id='01')   -- ä¿®è¿‡01è¯¾ç¨‹ï¼Œè¦ä¿ç•™
and s1.s_id not in (select s_id from Score where c_id='02');  -- å“ªäº›äººä¿®è¿‡02ï¼Œéœ€è¦æ’é™¤
```

![](https://tva1.sinaimg.cn/large/0081Kckwgy1gkgifql6vwj312y0dm0ue.jpg)

![](https://tva1.sinaimg.cn/large/0081Kckwgy1gkgip48kmjj30w50u0jua.jpg)



ï¼ï¼ï¼ï¼ï¼æ–¹æ³•2ï¼šå…ˆæŠŠ06å·å­¦ç”Ÿæ‰¾å‡ºæ¥

```sql
select * from Student where s_id in (
  select s_id 
  from Score 
  where c_id='01'   -- ä¿®è¿‡01è¯¾ç¨‹çš„å­¦å·
  and s_id not in (select s_id   -- åŒæ—¶å­¦å·ä¸èƒ½åœ¨ä¿®è¿‡02è¯¾ç¨‹ä¸­å‡ºç°
                   from Score 
                   where c_id='02')
);
```

![](https://tva1.sinaimg.cn/large/0081Kckwgy1gkgjb043c2j311w0ei0tx.jpg)

![](https://tva1.sinaimg.cn/large/0081Kckwgy1gkgj9yojbmj30s60jeq4v.jpg)

### é¢˜ç›®11

#### é¢˜ç›®éœ€æ±‚

æŸ¥è¯¢æ²¡æœ‰å­¦å®Œ**å…¨éƒ¨è¯¾ç¨‹**çš„**åŒå­¦**çš„ä¿¡æ¯

#### SQLå®ç°



```sql
-- è‡ªå·±çš„æ–¹æ³•
select *   -- æ’é™¤å­¦å·åå¾—åˆ°çš„ç»“æœ
from Student 
where s_id not in (select s_id from (select s_id, count(s_id) as number  -- 3.æœ€å¤§è¯¾ç¨‹æ•°æ‰€åœ¨çš„å­¦å·éœ€è¦æ’é™¤
                  from Score 
                  group by s_id) s  -- å–åˆ«å
where number=(select max(number)   -- 2.ä¿è¯æœ€å¤§çš„è¯¾ç¨‹æ•°
              from( select s_id, count(s_id) as number  -- 1.å­¦å·å’Œä¸ªæ•°ç»Ÿè®¡ï¼ˆå³ä¿®äº†å‡ é—¨è¯¾ï¼‰
                   from Score group by s_id)t));  -- åˆ«å
```

![](https://tva1.sinaimg.cn/large/0081Kckwgy1gkgy38o0iwj31mm0me42r.jpg)

è‡ªå·±çš„æ–¹æ³•ä¸€å¼€å§‹åœ¨è¯¾ç¨‹çš„æœ€å¤§æ•°ä¸­æ²¡æœ‰ä½¿ç”¨Courseè¡¨ï¼Œå¯¼è‡´å¤šä½¿ç”¨äº†ä¸€ä¸ªä¸´æ—¶è¡¨çš„ç»“æœï¼Œç°åœ¨æ”¹æˆä½¿ç”¨Courseè¡¨çš„ç»Ÿè®¡å€¼ï¼ˆ3ï¼‰ä½œä¸ºè¯¾ç¨‹çš„æ€»æ•°ï¼š

```sql
select s.* 
from Student s
where s_id not in (
  select s_id 
  from Score s1
  group by s_id 
  having count(*) = (select count(*) from Course)
);
```

![](https://tva1.sinaimg.cn/large/0081Kckwgy1gkgzscv55rj30yi0m8413.jpg)

```sql
-- æ–¹æ³•2ï¼šhaving

select s.* 
from Student s  -- å­¦ç”Ÿè¡¨
left join Score s1  -- æˆç»©è¡¨
on s1.s_id = s.s_id
group by s.s_id  -- å­¦å·åˆ†ç»„
having count(s1.c_id) < (  -- åˆ†ç»„åå­¦ç”Ÿçš„è¯¾ç¨‹æ•°<3
  select count(*) from Course  -- å…¨éƒ¨è¯¾ç¨‹æ•°=3
)
```



### é¢˜ç›®12



#### é¢˜ç›®éœ€æ±‚

æŸ¥è¯¢è‡³å°‘æœ‰ä¸€é—¨è¯¾ä¸å­¦å·ä¸º01çš„åŒå­¦æ‰€å­¦ç›¸åŒçš„åŒå­¦çš„ä¿¡æ¯

#### SQLå®ç°

é¦–å…ˆçœ‹çœ‹ç»“æœçš„ï¼šå› ä¸º01å·åŒå­¦ä¿®äº†å…¨éƒ¨è¯¾ç¨‹ï¼Œæ‰€ä»¥å…¶ä»–çš„åŒå­¦éƒ½æ˜¯æ»¡è¶³è¦æ±‚ï¼Œ**é™¤äº†08å·åŒå­¦æ²¡æœ‰ä»»ä½•æˆç»©ï¼Œä¸ç¬¦åˆ**ã€‚

![](https://tva1.sinaimg.cn/large/0081Kckwgy1gkh2xec8hej30la0v8acc.jpg)

å…·ä½“å®ç°è¿‡ç¨‹ä¸ºï¼š

```sql
select *   -- 3ã€æ±‚å‡ºå­¦ç”Ÿä¿¡æ¯
from Student 
where s_id in (
  select distinct s_id   -- 2ã€æ‰¾å‡ºæ»¡è¶³è¯¾ç¨‹åœ¨01å­¦ç”Ÿè¯¾ç¨‹ä¸­çš„å…¨éƒ¨å­¦å·ï¼ˆå­¦ç”Ÿï¼‰ï¼Œå­¦å·å»é‡ï¼ŒåŒæ—¶å°†01è‡ªå·±æ’é™¤
  from Score 
  where c_id in (
    select c_id 
    from Score 
    where s_id=01   -- 1ã€æ‰¾å‡ºå­¦å·01åŒå­¦çš„å…¨éƒ¨è¯¾ç¨‹
                ) 
  and s_id != 01);
```

![](https://tva1.sinaimg.cn/large/0081Kckwgy1gkh3rfbw54j31pk0ri0xj.jpg)

```sql
-- æ–¹æ³•2
select s1.*
from Student s1
join Score s2
on s1.s_id = s2.s_id  -- å­¦ç”Ÿè¡¨å’Œæˆç»©è¡¨çš„å…³è”
and c_id in (select c_id from Score where s_id=01)  -- å¯¹è¯¾ç¨‹è¿›è¡Œé™åˆ¶ï¼Œåªåœ¨01å­¦ç”Ÿçš„è¯¾ç¨‹å†…
group by s1.s_id;  -- æ ¹æ®å­¦å·åˆ†ç»„
```

![](https://tva1.sinaimg.cn/large/0081Kckwgy1gkh43lth8ej31ay0nqdjq.jpg)

### é¢˜ç›®13

#### é¢˜ç›®éœ€æ±‚

æŸ¥è¯¢å’Œ01åŒå­¦å­¦ä¹ çš„è¯¾ç¨‹å®Œå…¨ç›¸åŒçš„åŒå­¦çš„ä¿¡æ¯

#### SQLå®ç°

1. è‡ªå·±çš„æ–¹æ³•

```sql
select * 
from Student 
where s_id in (select s_id   -- 3ã€æ­¥éª¤2ä¸­å¾—åˆ°çš„å­¦å·æ˜¯æ»¡è¶³è¦æ±‚çš„
               from(select distinct(s_id), count(c_id) number 
                    from Score 
                    group by s_id)t1 -- 1ã€å­¦å·å’Œæ‰€ä¿®è¯¾ç¨‹åˆ†ç»„çš„ç»“æœt1
               where number=3  -- 2ã€æŠ•æœºï¼šé€‰æ‹©å‡ºæ‰€ä¿®è¯¾ç¨‹æ•°æ˜¯3ï¼ˆ01ä¿®äº†3é—¨ï¼‰çš„å­¦å·
               and s_id !=01  -- 01 æœ¬èº«æ’é™¤
              );             
```

![](https://tva1.sinaimg.cn/large/0081Kckwgy1gkh4pxa5jgj31au0lytcs.jpg)

æˆ‘ä»¬åœ¨ä¸Šé¢çš„æ­¥éª¤2ä¸­ä¸è€ƒè™‘ç›´æ¥æŒ‡å®š3ï¼ˆwhere number=3ï¼‰ï¼Œè€Œæ˜¯ç”¨01å­¦ç”Ÿæ‰€ä¿®çš„è¯¾ç¨‹æ•°ï¼ˆè™½ç„¶ä¹Ÿæ˜¯3ï¼‰æ¥ä»£æ›¿ï¼š

```sql
select * 
from Student 
where s_id in(
  select s_id   -- 3ã€æ­¥éª¤2ä¸­å¾—åˆ°çš„å­¦å·æ˜¯æ»¡è¶³è¦æ±‚çš„
  from(select distinct(s_id), count(c_id) number 
       from Score 
       group by s_id)t1 -- 1ã€å­¦å·å’Œæ‰€ä¿®è¯¾ç¨‹åˆ†ç»„çš„ç»“æœt1
       where number=(select count(c_id) number 
                     from Score 
                     group by s_id having s_id=01)  -- 2ã€æ”¹å˜çš„åœ°æ–¹ï¼šä½¿ç”¨å­¦å·01çš„è¯¾ç¨‹æ•°3æ¥ä»£æ›¿
  and s_id !=01  -- 01 æœ¬èº«æ’é™¤
);             
```

![](https://tva1.sinaimg.cn/large/0081Kckwgy1gkh4x7zhvzj31dy0qgjvy.jpg)

2. ä½¿ç”¨`group_concat`å‡½æ•°

`group_concat`çš„ä½¿ç”¨æ–¹æ³•ä¸ºï¼š

```sql
group_concat([DISTINCT] å­—æ®µ [Order BY ASC/DESC æ’åºå­—æ®µ] [Separator 'åˆ†éš”ç¬¦'])
```

æˆ‘ä»¬å°†`Score`è¡¨ä¸­æ¯ä¸ª`s_id`çš„`c_id`è¿›è¡Œåˆ†ç»„åˆå¹¶ï¼Œå®é™…çš„æ•ˆæœå¦‚ä¸‹ï¼š

```sql
select 
	s_id
	,group_concat(c_id order by c_id) -- åˆ†ç»„åˆå¹¶ï¼ŒåŒæ—¶æ’åº
from Score 
group by s_id;
```

![](https://tva1.sinaimg.cn/large/0081Kckwgy1gkhieluel4j310c0mg40t.jpg)

**éœ€è¦è¿›è¡Œæ’åºçš„åŸå› **æ˜¯é˜²æ­¢å‡ºç°è¿™ç§æƒ…å†µï¼š01ä¿®çš„è¯¾ç¨‹é¡ºåºæ˜¯ï¼š01ï¼Œ02ï¼Œ03ï¼›å¦‚æœæœ‰åŒå­¦ä¿®è¯¾çš„é¡ºåºæ˜¯02ï¼Œ03ï¼Œ01ï¼Œè™½ç„¶é¡ºåºä¸åŒï¼Œä½†æ˜¯æœ¬è´¨ä¸Šä»–ä»¬ä¿®çš„è¯¾ç¨‹æ˜¯ç›¸åŒçš„

**ä½¿ç”¨æ’åºåéƒ½ä¼šå˜æˆï¼š01ï¼Œ02ï¼Œ03ï¼Œä¿è¯ç»“æœç›¸åŒ**

é‚£ä¹ˆä¹‹åï¼Œæˆ‘ä»¬åªéœ€è¦åˆ¤æ–­åˆå¹¶åå’Œ01å·åŒå­¦ç›¸åŒçš„ç»“æœå³å¯ï¼Œå–å‡ºå­¦å·ï¼š

```sql
select *   -- 3ã€æŸ¥è¯¢ä¿¡æ¯
from Student
where s_id in(
  select s_id 
  from Score 
  group by s_id 
  having group_concat(c_id order by c_id)=(   -- 2ã€æ‰¾å‡ºå’Œ01å·å­¦ç”Ÿåˆ†ç»„åˆå¹¶ç»“æœç›¸åŒçš„å­¦å·s_idï¼›ä¹Ÿéœ€è¦æ’åº
    select group_concat(c_id order by c_id)   -- 1ã€æ‰¾å‡º01å·å­¦ç”Ÿåˆ†ç»„åˆå¹¶çš„ç»“æœï¼ŒåŒæ—¶æ’åºï¼›æ’åºå¾ˆé‡è¦
    from Score 
    group by s_id
    having s_id=01)
  and s_id != 01  -- å°†è‡ªèº«æ’é™¤
);
```

![](https://tva1.sinaimg.cn/large/0081Kckwgy1gkhj18bt4tj30t80rcn0j.jpg)



### é¢˜ç›®14

#### é¢˜ç›®éœ€æ±‚

æŸ¥è¯¢**æ²¡æœ‰ä¿®è¿‡å¼ ä¸‰**è€å¸ˆè®²æˆçš„**ä»»ä½•ä¸€é—¨**è¯¾ç¨‹çš„**å­¦ç”Ÿå§“å**

#### SQLå®ç°

è‡ªå·±çš„æ–¹æ³•ï¼Œå…·ä½“è¿‡ç¨‹å¦‚ä¸‹ï¼š

```sql
select s_name   -- 4ã€å­¦å·å–åæ‰¾åˆ°å­¦ç”Ÿå§“å
from Student 
where s_id not in(
  select distinct(s_id) -- 3ã€è¯¾ç¨‹å·æ‰¾åˆ°å¯¹åº”çš„å­¦å·
  from Score 
  where c_id=(
    select c_id -- 2ã€æ•™å¸ˆç¼–å·æ‰¾åˆ°å¯¹åº”çš„è¯¾ç¨‹å·
    from Course 
    where t_id=(
      select t_id   -- 1ã€å§“åæ‰¾åˆ°æ•™å¸ˆç¼–å·
      from Teacher 
      where t_name='å¼ ä¸‰')
  ));
```

![](https://tva1.sinaimg.cn/large/0081Kckwgy1gkhlggkp6dj30y80r4adi.jpg)

```sql
 -- ä¿®è¿‡å¼ è€å¸ˆè¯¾ç¨‹çš„å­¦ç”Ÿçš„å­¦å·
 select distinct(s_id) 
 from Score 
 where c_id=(
   select c_id 
   from Course 
   where t_id=(
     select t_id 
     from Teacher 
     where t_name='å¼ ä¸‰')); -- ä¿®è¿‡å¼ ä¸‰è€å¸ˆè¯¾çš„å­¦ç”Ÿ
```

![](https://tva1.sinaimg.cn/large/0081Kckwgy1gkhliy3chaj30ze0qiq59.jpg)

### é¢˜ç›®15

#### é¢˜ç›®éœ€æ±‚

æŸ¥è¯¢ä¸¤é—¨åŠå…¶ä»¥ä¸Šä¸åŠæ ¼è¯¾ç¨‹çš„åŒå­¦çš„å­¦å·ï¼Œå§“ååŠå…¶å¹³å‡æˆç»©

#### SQLå®ç°

é¦–å…ˆçœ‹çœ‹å“ªäº›åŒå­¦æ˜¯æ»¡è¶³ä¸¤é—¨æˆ–è€…ä¸¤é—¨ä»¥ä¸Šæ˜¯åŠæ ¼çš„

![](https://tva1.sinaimg.cn/large/0081Kckwgy1gki75egyr4j313s0jumz2.jpg)

```sql
-- 2é—¨åŠä»¥ä¸Šä¸åŠæ ¼çš„

select 
	s_id
  ,round(avg(s_score))  avg_score
from Score 
where s_score < 60 -- å°äº60åˆ†ï¼Œä¸åŠæ ¼
group by s_id
having count(s_score) >= 2;   -- ä¸åŠæ ¼çš„æœ‰2é—¨ä»¥ä¸Š
```

**è¯´æ˜04ï¼Œ06æ˜¯æˆ‘ä»¬æœ€ç»ˆæƒ³è¦çš„ç»“æœ**



![](https://tva1.sinaimg.cn/large/0081Kckwgy1gki7gz0gfij310i0gs40c.jpg)

```sql
-- è‡ªå·±çš„æ–¹æ³•
select 
	s.s_id
	,s.s_name 
	,t.avg_score
from Student s
join (select 
      	s_id
      	,round(avg(s_score))  avg_score
      from Score 
      where s_score < 60 
      group by s_id
      having count(s_score) >= 2)t
on s.s_id=t.s_id
```

![](https://tva1.sinaimg.cn/large/0081Kckwgy1gki7kcxf18j30x60poju2.jpg)

```sql
-- å‚è€ƒæ–¹æ³•1

select 
	a.s_id,
	a.s_name,
	ROUND(AVG(b.s_score)) 
from Student a 
left join Score b 
on a.s_id = b.s_id
where a.s_id in(
  select s_id 
  from Score 
  where s_score<60 
  group by s_id 
  having count(1)>=2)
group by a.s_id,a.s_name

-- å‚è€ƒæ–¹æ³•2
select 
	s.s_id
	,s_name
	,round(avg(s_score), 2) avg_score
from Student s
join Score sc
on s.s_id=sc.s_id
and sc.s_score < 60  -- ä¸åŠæ ¼
group by s.s_id   -- å­¦å·åˆ†ç»„
having count(sc.c_id )>= 2;   -- 2é—¨è¯¾	
```

#### æ”¹è¿›ç‚¹

ä¸Šé¢çš„ä¸¤ç§æ–¹æ³•éƒ½æ²¡æœ‰è€ƒè™‘éƒ½08å­¦ç”Ÿï¼Œ3é—¨éƒ½æ²¡æœ‰æˆç»©ï¼Œè¿™ä¸ªæœ¬é¢˜éœ€è¦æ”¹è¿›çš„åœ°æ–¹ã€‚



### é¢˜ç›®16

#### é¢˜ç›®éœ€æ±‚

æ£€ç´¢**01è¯¾ç¨‹**åˆ†æ•°å°äº60ï¼ŒæŒ‰åˆ†æ•°**é™åº**æ’åˆ—çš„å­¦ç”Ÿä¿¡æ¯

#### SQLå®ç°

è‡ªå·±çš„æ–¹æ³•å¦‚ä¸‹ï¼š

é¦–å…ˆä»Scoreè¡¨ä¸­æ‰¾å‡ºå“ªäº›å­¦ç”Ÿæ˜¯æ»¡è¶³è¿™ä¸ªè¦æ±‚ï¼š

```sql
select 
	s_id
	,s_score  
from Score 
where s_score < 60 
and c_id = 01;
```

![](https://tva1.sinaimg.cn/large/0081Kckwgy1gkkfx6z66lj30j80h43zo.jpg)

ç„¶åç›´æ¥å°†ä¸Šé¢çš„ç»“æœå’ŒStudentè¡¨æŸ¥è¯¢ï¼š

```sql
select s.*
from Student s
where s.s_id in (
  select 
  	s_id
  	,s_score
	from Score 
	where s_score < 60 
	and c_id = 01
);
```

![](https://tva1.sinaimg.cn/large/0081Kckwgy1gkkg0h8zbcj30su0kc0un.jpg)

```sql
select 
	s.*
	,t.s_score 
from Student s 
join (select s_id,s_score   -- 2ã€Studentå’Œtçš„è¿æ¥æŸ¥è¯¢
      from Score 
      where s_score < 60  
      and c_id = 01 )t   -- 1ã€å°†ç¬¬ä¸€æ­¥ç»“æœä½œä¸ºä¸­é—´è¡¨t
on s.s_id=t.s_id;
```

![](https://tva1.sinaimg.cn/large/0081Kckwgy1gkkg5bfvbfj30za0l8ju4.jpg)

```sql
-- è‡ªå·±çš„æ–¹æ³•2ï¼šä¸¤ä¸ªè¡¨çš„ç›´æ¥è¿æ¥æŸ¥è¯¢+whereæ¡ä»¶
select 
	s.*
	,sc.s_score
from Student s
join Score sc
on s.s_id=sc.s_id
where sc.c_id=01 and sc.s_score < 60 
order by sc.s_score desc;  -- é»˜è®¤å°±æ˜¯é™åºdesc
```

![](https://tva1.sinaimg.cn/large/0081Kckwgy1gkkg9z65x3j30wq0jcjtp.jpg)

### é¢˜ç›®17

#### é¢˜ç›®éœ€æ±‚

æŒ‰å¹³å‡æˆç»©**ä»é«˜åˆ°ä½**ï¼ˆé™åºï¼‰æ˜¾ç¤º**æ‰€æœ‰å­¦ç”Ÿ**çš„**æ‰€æœ‰è¯¾ç¨‹çš„æˆç»©**ä»¥åŠå¹³å‡æˆç»©

#### SQLå®ç°

ä¸‹é¢æ˜¯è‡ªå·±çš„è§£æ³•ï¼š

1ã€å…ˆæ±‚å‡ºæ¯ä¸ªåŒå­¦çš„å¹³å‡åˆ†ï¼Œå¹¶é™åºæ’åˆ—

```sql
select 
	s_id
	,round(avg(s_score),2) avg_score 
from Score 
group by s_id 
order by 2 desc;
```

![](https://tva1.sinaimg.cn/large/0081Kckwgy1gkkgibosmuj30pc0ncwgf.jpg)

```sql
-- è‡ªå·±çš„æ–¹æ³•
select 
	s.s_id
	,s.c_id
	,s.s_score
	,t.avg_score
from Score s
join (select 
      	s_id
        ,round(avg(s_score),2) avg_score 
      from Score 
      group by s_id)t
on s.s_id = t.s_id
order by 4 desc;  -- æŒ‡çš„æ˜¯ç¬¬4ä¸ªå­—æ®µ
```

![](https://tva1.sinaimg.cn/large/0081Kckwgy1gkkgqbekdnj30u019o793.jpg)

```sql
-- å‚è€ƒæ–¹æ³•1
select 
	s.s_id
	,(select s_score from Score where s_id=s.s_id and c_id='01')
	 as è¯­æ–‡
	 ,(select s_score from Score where s_id=s.s_id and c_id='02')
	 as æ•°å­¦
	 ,(select s_score from Score where s_id=s.s_id and c_id='03')
	 as è‹±è¯­
	 ,round(avg(s_score),2) å¹³å‡åˆ† 
from Score s
group by s.s_id
order by 5 desc;
```

![image-20201110225804782](https://tva1.sinaimg.cn/large/0081Kckwgy1gkkgzjgbtbj31990u0aes.jpg)

```sql
select 
	s.s_id
	,max(case s.c_id when '01' then s.s_score end) è¯­æ–‡
	,max(case s.c_id when '02' then s.s_score end) æ•°å­¦
	,max(case s.c_id when '03' then s.s_score end) è‹±è¯­
	,avg(s.s_score)
	,b.s_name  -- æ²¡æœ‰å‡ºç°åœ¨group byå­å¥ä¸­ï¼Œå¯¼è‡´æŠ¥é”™
join Student b
on s.s_id = b.s_id
group by s.s_id
order by 5 desc;
```

ä¸¥æ ¼æ¨¡å¼çš„æŠ¥é”™ï¼š

> ERROR 1055 (42000): Expression #6 of SELECT list is not in GROUP BY clause and contains nonaggregated column 'test.b.s_name' which is not functionally dependent on columns in GROUP BY clause; this is incompatible with sql_mode=only_full_group_by

**å¯¹äºGROUP BYèšåˆæ“ä½œï¼Œå¦‚æœåœ¨SELECTä¸­çš„åˆ—ï¼Œæ²¡æœ‰åœ¨GROUP BYä¸­å‡ºç°ï¼Œé‚£ä¹ˆè¿™ä¸ªSQLæ˜¯ä¸åˆæ³•çš„ï¼Œå› ä¸ºåˆ—ä¸åœ¨GROUP BYä»å¥ä¸­ï¼Œä¹Ÿå°±æ˜¯è¯´æŸ¥å‡ºæ¥çš„åˆ—å¿…é¡»åœ¨group byåé¢å‡ºç°å¦åˆ™å°±ä¼šæŠ¥é”™ï¼Œæˆ–è€…è¿™ä¸ªå­—æ®µå‡ºç°åœ¨èšåˆå‡½æ•°é‡Œé¢**ã€‚

```sql
-- å‚è€ƒæ–¹æ³•2ï¼šå°†ä¸Šé¢çš„b.s_nameå»æ‰

select 
   s.s_id
   ,max(case s.c_id when '01' then s.s_score end) è¯­æ–‡
   ,max(case s.c_id when '02' then s.s_score end) æ•°å­¦
   ,max(case s.c_id when '03' then s.s_score end) è‹±è¯­
   ,round(avg(s.s_score),2)  avg_score
from Score s 
join Student b
on s.s_id = b.s_id
group by s.s_id
order by 5 desc;
```

![](https://tva1.sinaimg.cn/large/0081Kckwgy1gkkhu1fruoj314c0ts42n.jpg)

### é¢˜ç›®18

#### é¢˜ç›®éœ€æ±‚

æŸ¥è¯¢å„ç§‘æˆç»©æœ€é«˜åˆ†ã€æœ€ä½åˆ†å’Œå¹³å‡åˆ†ï¼šä»¥å¦‚ä¸‹å½¢å¼æ˜¾ç¤ºï¼šè¯¾ç¨‹IDï¼Œè¯¾ç¨‹nameï¼Œæœ€é«˜åˆ†ï¼Œæœ€ä½åˆ†ï¼Œå¹³å‡åˆ†ï¼ŒåŠæ ¼ç‡ï¼Œä¸­ç­‰ç‡ï¼Œä¼˜è‰¯ç‡ï¼Œä¼˜ç§€ç‡ï¼›åŠæ ¼ï¼š>=60ï¼Œä¸­ç­‰ä¸ºï¼š70-80ï¼Œä¼˜è‰¯ä¸ºï¼š80-90ï¼Œä¼˜ç§€ä¸ºï¼š>=90

#### SQLå®ç°

**æ€è·¯æ¸…æ™°ï¼šç»Ÿè®¡æ¯ä¸ªé˜¶æ®µçš„æ€»äººæ•°ï¼Œå†é™¤ä»¥æ€»å…±çš„äººæ•°å³å¯**

å°†æˆç»©è¡¨å’Œè¯¾ç¨‹è¡¨è”åˆèµ·æ¥è¿›è¡ŒæŸ¥è¯¢ï¼š

- case è¯­å¥ç”¨äºå¯¹æ¯ä¸ªåˆ†æ•°è´´æ ‡ç­¾
- sum è¯­å¥å¯¹ç›¸åº”çš„è¯­å¥ä¸­çš„1è¿›è¡Œæ±‚å’Œ

```sql
select 
	s.c_id
	,c.c_name
	,max(s.s_score)
	,min(s.s_score)
	,round(avg(s.s_score), 2)
	,round(100 * (sum(case when s.s_score >= 60 then 1 else 0 end) / sum(case when s.s_score then 1 else 0 end)), 2) as åŠæ ¼ç‡
	,round(100 * (sum(case when s.s_score >= 70 and s.s_score <= 80 then 1 else 0 end) / sum(case when s.s_score then 1 else 0 end)), 2) as ä¸­ç­‰ç‡
	,round(100 * (sum(case when s.s_score >= 80 and s.s_score <= 90 then 1 else 0 end) / sum(case when s.s_score then 1 else 0 end)), 2) as ä¼˜è‰¯ç‡
	,round(100 * (sum(case when s.s_score >= 90 then 1 else 0 end) / sum(case when s.s_score then 1 else 0 end)), 2) as ä¼˜ç§€ç‡
from Score s
left join Course c
on s.c_id = c.c_id
group by s.c_id, c.c_name;
```

![](https://tva1.sinaimg.cn/large/0081Kckwgy1gkri0c82yyj324o0u0dmr.jpg)

### é¢˜ç›®19

#### é¢˜ç›®éœ€æ±‚

æŒ‰ç…§å„ç§‘æˆç»©è¿›è¡Œæ’åºï¼Œå¹¶ä¸”æ˜¾ç¤ºæ’å

#### åˆ†æè¿‡ç¨‹

é¢˜ç›®çš„æ„æ€æ˜¯ï¼šå°†æ¯ç§‘çš„æˆç»©å•ç‹¬è¿›è¡Œæ’åï¼Œç±»ä¼¼å¦‚ä¸‹çš„æ•ˆæœï¼š

| è¯¾ç¨‹å | åˆ†æ•° | æ’å |
| ------ | ---- | ---- |
| è‹±è¯­   | 99   | 1    |
| è‹±è¯­   | 92   | 2    |
| è‹±è¯­   | 89   | 3    |
| æ•°å­¦   | 88   | 1    |
| æ•°å­¦   | 85   | 2    |
| â€¦â€¦     | â€¦â€¦   | â€¦... |

#### SQLå®ç°

ç¬¬ä¸€æ­¥ï¼šæˆ‘ä»¬å¯¹Scoreè¡¨ä¸­çš„ä¸€é—¨è¯¾ç¨‹è¿›è¡Œæ’åï¼Œæ¯”å¦‚01è¯¾ç¨‹

```sql
select * from(
  select
  	t1.c_id  -- è¯¾ç¨‹å·
  	,t1.s_score  -- åˆ†æ•°
  	,(select count(distinct t2.s_score)   -- è¯¾ç¨‹å»é‡
      from Score t2
      where t2.s_score  >= t1.s_score   -- SQLå®ç°æ’åº
      and t2.c_id = '01') rank
  from Score t1   -- é€šè¿‡ç›¸åŒçš„è¡¨å®ç°è‡ªè¿æ¥
  where t1.c_id = '01'
  order by t1.s_score desc
)t1
```

ä¸Šé¢æ˜¯é’ˆå¯¹01è¯¾ç¨‹ï¼Œç»“æœä¸ºï¼š

![](https://tva1.sinaimg.cn/large/0081Kckwgy1gkse3sadxbj314y0u0787.jpg)

ç¬¬äºŒæ­¥ï¼šæˆ‘ä»¬å°†01ã€02ã€03è¯¾ç¨‹å…¨éƒ¨è¿æ¥èµ·æ¥ï¼Œé€šè¿‡unionå®ç°

- è¡¨çš„è‡ªè¿æ¥
- SQLå®ç°æ’åº

```sql
-- è‡ªå·±çš„æ–¹æ³•

select * from(
  select
  	t1.c_id  -- è¯¾ç¨‹å·
  	,t1.s_score  -- åˆ†æ•°
  	,(select count(distinct t2.s_score)   -- è¯¾ç¨‹å»é‡
      from Score t2
      where t2.s_score  >= t1.s_score   -- SQLå®ç°æ’åº
      and t2.c_id = '01') rank
  from Score t1   -- é€šè¿‡ç›¸åŒçš„è¡¨å®ç°è‡ªè¿æ¥
  where t1.c_id = '01'
  order by t1.s_score desc
)t1

union
select * from(
  select
  	t1.c_id  -- è¯¾ç¨‹å·
  	,t1.s_score  -- åˆ†æ•°
  	,(select count(distinct t2.s_score)   -- è¯¾ç¨‹å»é‡
      from Score t2
      where t2.s_score  >= t1.s_score   -- SQLå®ç°æ’åº
      and t2.c_id = '02') rank
  from Score t1   -- é€šè¿‡ç›¸åŒçš„è¡¨å®ç°è‡ªè¿æ¥
  where t1.c_id = '02'
  order by t1.s_score desc
)t2

union
select * from(
  select
  	t1.c_id  -- è¯¾ç¨‹å·
  	,t1.s_score  -- åˆ†æ•°
  	,(select count(distinct t2.s_score)   
      from Score t2
      where t2.s_score  >= t1.s_score   
      and t2.c_id = '03') rank
  from Score t1   
  where t1.c_id = '03'
  order by t1.s_score desc
)t3;
```



![](https://tva1.sinaimg.cn/large/0081Kckwgy1gks6h58yzwj30l40qyabt.jpg)

```sql
-- å‚è€ƒä»£ç 

select * from (select 
                t1.c_id,
                t1.s_score,
                (select count(distinct t2.s_score) 
                 from Score t2 
                 where t2.s_score>=t1.s_score and t2.c_id='01') rank
              from Score t1 where t1.c_id='01'
              order by t1.s_score desc) t1

union
select * from (select 
                 t1.c_id
                 ,t1.s_score
                 ,(select count(distinct t2.s_score)
                   from Score t2 
                   where t2.s_score>=t1.s_score and t2.c_id='02') rank
               from Score t1 where t1.c_id='02'
               order by t1.s_score desc) t2

union
  select * from (select 
                  t1.c_id,
                  t1.s_score,
                  (select count(distinct t2.s_score) from Score t2 where t2.s_score>=t1.s_score and t2.c_id='03') rank
                from Score t1 where t1.c_id='03'
                order by t1.s_score desc) t3
```





### é¢˜ç›®20

#### é¢˜ç›®éœ€æ±‚

æŸ¥è¯¢å­¦ç”Ÿçš„æ€»æˆç»©ï¼Œå¹¶è¿›è¡Œæ’å

#### SQLå®ç°

1ã€å…ˆæŸ¥è¯¢æ¯ä¸ªå­¦ç”Ÿçš„æ€»æˆç»©

```sql
select 
	s_id
	,sum(s_score)
from Score
group by s_id
order by 2 desc;
```

![](https://tva1.sinaimg.cn/large/0081Kckwgy1gks2opn3a0j30ie0nsgna.jpg)

å°†ä¸Šé¢çš„ç»“æœå’Œå­¦ç”Ÿä¿¡æ¯è¡¨è¿›è¡Œå…³è”æŸ¥è¯¢ï¼š

```sql
-- 
select
	s.s_name
	,s.s_id
	,t.score
from Student s
join(select 
     	s_id
     ,sum(s_score) score
     from Score
     group by s_id
     order by 2 desc
)t
on s.s_id = t.s_id;
```

![](https://tva1.sinaimg.cn/large/0081Kckwgy1gks2w4cwp3j30r40wm41m.jpg)

```sql
-- ä¸ä½¿ç”¨ä¸­é—´è¡¨æŸ¥è¯¢

select 
	s.s_id
	,s.s_name 
	,sum(sc.s_score) score
from Student s
join Score sc
on s.s_id = sc.s_id
group by s.s_id
order by 3 desc;
```

![](https://tva1.sinaimg.cn/large/0081Kckwgy1gks2zfe8ylj30mk0r6q5i.jpg)

å¦‚æœæƒ³ç»™æ’ååŠ ä¸Šä¸€ä¸ªæ’åºå·ï¼Œå‚è€ƒä¹‹å‰çš„[æ–‡ç« ](http://renpeter.cn/2020/08/30/SQL%E8%BF%9B%E9%98%B6-3-%E6%8E%92%E5%BA%8F%E4%B8%8E%E7%AA%97%E5%8F%A3%E5%87%BD%E6%95%B0.html)

```sql
-- åŠ ä¸Šæ’åºå·

select 
	t1.s_id ,t1.s_name, t1.score
	,(select count(t2.score)
    from(select s.s_id, s.s_name, sum(sc.s_score) score
         from Student s
         join Score sc
         on s.s_id = sc.s_id
         group by s.s_id
         order by 3 desc)t2   -- t2å’Œt1ç›¸åŒ
    where t2.score > t1.score) + 1 as rank
from(
  select s.s_id ,s.s_name ,sum(sc.s_score) score
  from Student s
  join Score sc
  on s.s_id = sc.s_id
  group by s.s_id
  order by 3 desc)t1   -- t1
order by 3 desc;
```

![](https://tva1.sinaimg.cn/large/0081Kckwgy1gks4olm3g0j30w30u0gqv.jpg)



### é¢˜ç›®21

#### é¢˜ç›®éœ€æ±‚

æŸ¥è¯¢ä¸åŒ**è€å¸ˆ**æ‰€æ•™ä¸åŒ**è¯¾ç¨‹å¹³å‡åˆ†**ä»é«˜åˆ°ä½æ˜¾ç¤º

#### SQLå®ç°

å…ˆæ‰¾å‡ºæ¯ä¸ªè€å¸ˆæ•™æˆäº†å“ªäº›è¯¾ç¨‹ï¼š

```sql
select 
	c.c_name
	,t.t_name
from Course c
left join Teacher t
on c.t_id = t.t_id;
```

![](https://tva1.sinaimg.cn/large/0081Kckwgy1gkuw9x3zcyj30is0ieq48.jpg)

å°†ä¸Šé¢çš„ç»“æœå’Œ**æˆç»©è¡¨**è¿æ¥èµ·æ¥ï¼š

```sql
select 
	c.c_name
	,t.t_name
	,round(avg(s.s_score),2)  score   -- è¯¾ç¨‹åˆ†ç»„åå†æ±‚å‡å€¼
from Course c   -- ä¸»è¡¨ï¼Œé€šè¿‡ä¸¤æ¬¡è¿æ¥
left join Teacher t
on c.t_id = t.t_id
left join Score s
on c.c_id = s.c_id
group by c.c_id   -- è¯¾ç¨‹åˆ†ç»„
order by 3 desc;  -- é™åº
```

![](https://tva1.sinaimg.cn/large/0081Kckwgy1gkuweo5gxjj31060oqgou.jpg)



### é¢˜ç›®22

#### é¢˜ç›®éœ€æ±‚

æŸ¥è¯¢æ‰€æœ‰è¯¾ç¨‹çš„æˆç»©ç¬¬2ååˆ°ç¬¬3åçš„å­¦ç”Ÿä¿¡æ¯åŠè¯¥è¯¾ç¨‹æˆç»©

#### SQLå®ç°

##### è‡ªå·±çš„æ–¹æ³•

1ã€è¯¾ç¨‹è¡¨å’Œæˆç»©è¡¨è¿æ¥èµ·æ¥ï¼Œæ˜¾ç¤ºæ‰€æœ‰çš„è¯¾ç¨‹å’Œæˆç»©ä¿¡æ¯

```sql
select 
	s.s_id
	,s.c_id
	,s.s_score
	,c.c_name
from Score s
join Course c
on s.c_id = c.c_id
```

![](https://tva1.sinaimg.cn/large/0081Kckwgy1gkuwq7p3u0j30nc13gdk1.jpg)

2ã€æŸ¥å‡ºå…¨éƒ¨çš„è¯­æ–‡æˆç»©

```sql
select s.s_id, s.s_score, c.c_name
from Score s
join Course c on s.c_id = c.c_id
where c.c_name = 'è¯­æ–‡'
order by s.s_score desc;
```

![](https://tva1.sinaimg.cn/large/0081Kckwgy1gkuwycg0hkj30sg0kwjtj.jpg)

3ã€æˆ‘ä»¬æ‰¾å‡ºè¯­æ–‡çš„ç¬¬2ã€3çš„å­¦ç”Ÿ

```sql
select s.s_id, s.s_score, c.c_name
from Score s
join Course c on s.c_id = c.c_id
where c.c_name = 'è¯­æ–‡'
order by s.s_score desc
limit 1, 2;
```

![](https://tva1.sinaimg.cn/large/0081Kckwgy1gkux0xrf1qj30so0hkmzh.jpg)

4ã€åŒæ—¶æ±‚å‡ºè¯­æ–‡ã€æ•°å­¦ã€è‹±è¯­çš„åˆ†æ•°ï¼Œå¹¶ä¸”é€šè¿‡`union`æ‹¼æ¥

```sql
-- unionè¿æ¥

(select s.s_id, s.s_score, c.c_name
from Score s
join Course c on s.c_id = c.c_id
where c.c_name = 'è¯­æ–‡'
order by s.s_score desc
limit 1, 2)

union

(select s.s_id, s.s_score, c.c_name
from Score s
join Course c on s.c_id = c.c_id
where c.c_name = 'æ•°å­¦'
order by s.s_score desc
limit 1, 2)

union
((select s.s_id, s.s_score, c.c_name
from Score s
join Course c on s.c_id = c.c_id
where c.c_name = 'è‹±è¯­'
order by s.s_score desc
limit 1, 2))
```

![](https://tva1.sinaimg.cn/large/0081Kckwgy1gkux41350mj30go0dwdgz.jpg)

5ã€å°†ä¸Šé¢çš„ç»“æœå­¦ç”Ÿä¿¡æ¯è¡¨è¿›è¡Œè¿æ¥å³å¯

å¥½æ­¹æ˜¯å®ç°äº†ğŸ˜­

```sql
-- æœ€ç»ˆè„šæœ¬
-- ï¼ï¼ï¼ï¼çœŸçš„éœ€è¦å¥½å¥½ä¼˜åŒ–ä¸‹

select
	s.s_id
	,s.s_name
	,t.c_name
	,t.s_score
from Student s
join (-- unionè¿æ¥

(select s.s_id, s.s_score, c.c_name
from Score s
join Course c on s.c_id = c.c_id
where c.c_name = 'è¯­æ–‡'
order by s.s_score desc
limit 1, 2)

union

(select s.s_id, s.s_score, c.c_name
from Score s
join Course c on s.c_id = c.c_id
where c.c_name = 'æ•°å­¦'
order by s.s_score desc
limit 1, 2)

union
((select s.s_id, s.s_score, c.c_name
from Score s
join Course c on s.c_id = c.c_id
where c.c_name = 'è‹±è¯­'
order by s.s_score desc
limit 1, 2)))t  -- ä¸´æ—¶è¡¨t

on s.s_id = t.s_id
```

![](https://tva1.sinaimg.cn/large/0081Kckwgy1gkux8eb5j1j30lm0e60ua.jpg)

##### å’Œç¬¬25é¢˜ç›¸åŒçš„æ–¹æ³•

1ã€ä»¥è¯­æ–‡ä¸ºä¾‹ï¼Œé¦–å…ˆæˆ‘ä»¬æ‰¾å‡ºå‰3åçš„æˆç»©ï¼ˆåŒ…å«ç›¸åŒçš„æˆç»©ï¼‰

```sql
-- è¯­æ–‡
select
	a.s_id
	,a.c_id
	,a.s_score   -- 3ã€æ­¤æ—¶aè¡¨çš„æˆç»©å°±æ˜¯æˆ‘ä»¬æ‰¾çš„  
from Score a
join Score b
on a.c_id = b.c_id
and a.s_score <= b.s_score  -- 1ã€åˆ¤æ–­açš„åˆ†æ•°å°äºç­‰äºbçš„åˆ†æ•°ï¼Œè¦å¸¦ä¸Šç­‰å·
and a.c_id="01"
group by 1,2
having count(b.s_id) <= 3  -- 2ã€bä¸­çš„ä¸ªæ•°è‡³å°‘æœ‰3ä¸ªï¼Œåº”å¯¹åˆ†æ•°ç›¸åŒçš„æƒ…å½¢
order by 3 desc
limit 1,2
```

![](https://tva1.sinaimg.cn/large/0081Kckwgy1gkwxbcajh7j317c0nedjj.jpg)

```sql
-- è¯­æ–‡
select
	a.s_id
	,a.c_id
	,a.s_score   -- 3ã€æ­¤æ—¶aè¡¨çš„æˆç»©å°±æ˜¯æˆ‘ä»¬æ‰¾çš„  
from Score a
join Score b
on a.c_id = b.c_id
and a.s_score <= b.s_score  -- 1ã€åˆ¤æ–­açš„åˆ†æ•°å°äºç­‰äºbçš„åˆ†æ•°ï¼Œè¦å¸¦ä¸Šç­‰å·
and a.c_id="01"
group by 1,2
having count(b.s_id) <= 3  -- 2ã€bä¸­çš„ä¸ªæ•°è‡³å°‘æœ‰3ä¸ªï¼Œåº”å¯¹åˆ†æ•°ç›¸åŒçš„æƒ…å½¢
order by 3 desc
limit 1,2;   -- å–å¾—ç¬¬2ã€3å
```

åœ¨é€šè¿‡æ•°å­¦å’Œè‹±è¯­çš„ç±»ä¼¼æ“ä½œå¾—åˆ°2ã€3åçš„æˆç»©ï¼Œå†è¿›è¡Œæ‹¼æ¥å³å¯

### é¢˜ç›®23

#### é¢˜ç›®éœ€æ±‚

ç»Ÿè®¡å„ç§‘æˆç»©å„åˆ†æ•°æ®µäººæ•°ï¼šè¯¾ç¨‹ç¼–å·ï¼Œè¯¾ç¨‹åç§°ï¼Œ[100-85]ï¼Œ[85-70]ï¼Œ[70-60]ï¼Œ[0-60]åŠæ‰€å ç™¾åˆ†æ¯”

#### SQLå®ç°

##### è‡ªå·±çš„æ–¹æ³•

1ã€å¦‚ä½•å¯¹æ¯ä¸ªæˆç»©è¿›è¡Œåˆ†ç»„å±•ç¤ºï¼šABCDä»£è¡¨ç›¸åº”çš„ç­‰çº§

```sql
select 
	c_id
	,s_score
	,case when s_score >= 85 and  s_score<= 100 then 'A'   -- å¤§å°å…³ç³»å¿…é¡»åˆ†ä¸¤æ¬¡å†™ï¼Œä¸€æ¬¡å†™çš„è¯MySQLæ— æ³•è¯†åˆ«
		when 70 <= s_score and s_score < 85 then 'B'
		when 60 <= s_score and s_score < 70 then 'C'
		when 0 <= s_score and s_score < 60 then 'D'
		else 'å…¶ä»–' end as 'category'
from Score s;
```

![](https://tva1.sinaimg.cn/large/0081Kckwgy1gkvuafu8bij30ks0tojtj.jpg)

2ã€å°†ä¸¤ä¸ªè¡¨å…³è”èµ·æ¥å±•ç¤ºæ•°æ®

```sql
-- 1ã€æŸ¥çœ‹å…¨éƒ¨è¯¾ç¨‹å’Œæˆç»©ä¿¡æ¯

select 
	s.c_id
	,c.c_name
	,s.s_score
	,case when s.s_score >= 85 and  s.s_score<= 100 then 'A'   -- å¤§å°å…³ç³»å¿…é¡»åˆ†ä¸¤æ¬¡å†™ï¼Œä¸€æ¬¡å†™çš„è¯MySQLæ— æ³•è¯†åˆ«
		when 70 <= s.s_score and s.s_score < 85 then 'B'
		when 60 <= s.s_score and s.s_score < 70 then 'C'
		when 0 <= s.s_score and s.s_score < 60 then 'D'
		else 'å…¶ä»–' end as 'category'
from Score s
join Course c 
on s.c_id = c.c_id;
```

![](https://tva1.sinaimg.cn/large/0081Kckwgy1gkwkyohk2sj30mw0rsad7.jpg)

3ã€å®Œæ•´ä»£ç 

```sql
select
	s.c_id  ç¼–å·
	,c.c_name  ç§‘ç›®
	,sum(case when s.s_score >= 85 and  s.s_score<= 100 then 1 else 0 end) "[85,100]äººæ•°"
	,round(100 * (sum(case when s.s_score >= 85 and  s.s_score<= 100 then 1 else 0 end) / sum(case when s.s_score then 1 else 0 end)), 2) as '[85,100]ç™¾åˆ†æ¯”'
	,sum(case when s.s_score >= 70 and  s.s_score<= 85 then 1 else 0 end) "[70,85]äººæ•°"
	,round(100 * (sum(case when s.s_score >= 70 and  s.s_score<= 85 then 1 else 0 end) / sum(case when s.s_score then 1 else 0 end)), 2) as '[70,85]ç™¾åˆ†æ¯”'
	,sum(case when s.s_score >= 60 and  s.s_score<= 70 then 1 else 0 end) "[60,70]äººæ•°"
	,round(100 * (sum(case when s.s_score >= 60 and  s.s_score<= 70 then 1 else 0 end) / sum(case when s.s_score then 1 else 0 end)), 2) as '[60,70]ç™¾åˆ†æ¯”'
	,sum(case when s.s_score >= 0 and  s.s_score<= 60 then 1 else 0 end) "[0,60]äººæ•°"
	,round(100 * (sum(case when s.s_score >= 0 and  s.s_score<= 60 then 1 else 0 end) / sum(case when s.s_score then 1 else 0 end)), 2) as '[0,60]ç™¾åˆ†æ¯”'
from Score s
left join Course c
on s.c_id = c.c_id
group by s.c_id, c.c_name
```

![](https://tva1.sinaimg.cn/large/0081Kckwgy1gkwlipsol2j320a0nidlm.jpg)



##### å‚è€ƒæ–¹æ³•

1ã€å…ˆç»Ÿè®¡æ¯ä¸ªé˜¶æ®µçš„äººæ•°å’Œå æ¯”

```sql
select 
	c_id
	,sum(case when s_score > 85 and s_score <=100 then 1 else 0 end) as '85-100'
	,round(100 * (sum(case when s_score > 85 and s_score <= 100 then 1 else 0 end) / count(*)), 2) 'å æ¯”'
from Score 
group by c_id;  -- åˆ†è¯¾ç¨‹ç»Ÿè®¡æ€»æ•°å’Œå æ¯”


-- æ–¹å¼2
select 
	c_id
	,sum(case when s_score > 85 and s_score <=100 then 1 else 0 end) as '85-100'
	,round(100 * (sum(case when s_score > 85 and s_score <= 100 then 1 else 0 end) / count(case when s_score then 1 else 0 end)), 2) 'å æ¯”'   -- ä¸åŒcount(*)
from Score 
group by c_id;  
```

![](https://tva1.sinaimg.cn/large/0081Kckwgy1gkwlwpoh9cj31oq0iidi9.jpg)

æ³¨æ„å¯¹æ¯”ï¼š

![](https://tva1.sinaimg.cn/large/0081Kckwgy1gkwlz17vvlj327e0k6whe.jpg)

2ã€æˆ‘ä»¬å°†4ç§æƒ…å†µåŒæ—¶æŸ¥å‡ºæ¥

```sql
select 
	c_id
	,sum(case when s_score > 85 and s_score <=100 then 1 else 0 end) as '85-100'
	,round(100 * (sum(case when s_score > 85 and s_score <= 100 then 1 else 0 end) / count(*)), 2) '[85,100]å æ¯”'
	,sum(case when s_score > 70 and s_score <=85 then 1 else 0 end) as '70-85'
	,round(100 * (sum(case when s_score > 70 and s_score <= 85 then 1 else 0 end) / count(*)), 2) '[70,85]å æ¯”'
	,sum(case when s_score > 60 and s_score <=70 then 1 else 0 end) as '60-70'
	,round(100 * (sum(case when s_score > 60 and s_score <= 70 then 1 else 0 end) / count(*)), 2) '[60,70]å æ¯”'
	,sum(case when s_score >=0 and s_score <=60 then 1 else 0 end) as '0-60'
	,round(100 * (sum(case when s_score > 0 and s_score <= 60 then 1 else 0 end) / count(*)), 2) '[0,60]å æ¯”'
from Score 
group by c_id;  -- åˆ†è¯¾ç¨‹ç»Ÿè®¡æ€»æ•°å’Œå æ¯”
```

![](https://tva1.sinaimg.cn/large/0081Kckwgy1gkwmb3rbozj31ni0o0jwb.jpg)

3ã€å°†ç§‘ç›®åç§°è¿æ¥èµ·æ¥

```sql
-- æ•´ä½“å’Œè‡ªå·±çš„æ–¹æ³•æ˜¯ç±»ä¼¼çš„
select 
	s.c_id
	,c.c_name
	,sum(case when s_score > 85 and s_score <=100 then 1 else 0 end) as '85-100'
	,round(100 * (sum(case when s_score > 85 and s_score <= 100 then 1 else 0 end) / count(*)), 2) '[85,100]å æ¯”'
	,sum(case when s_score > 70 and s_score <=85 then 1 else 0 end) as '70-85'
	,round(100 * (sum(case when s_score > 70 and s_score <= 85 then 1 else 0 end) / count(*)), 2) '[70,85]å æ¯”'
	,sum(case when s_score > 60 and s_score <=70 then 1 else 0 end) as '60-70'
	,round(100 * (sum(case when s_score > 60 and s_score <= 70 then 1 else 0 end) / count(*)), 2) '[60,70]å æ¯”'
	,sum(case when s_score >=0 and s_score <=60 then 1 else 0 end) as '0-60'
	,round(100 * (sum(case when s_score > 0 and s_score <= 60 then 1 else 0 end) / count(*)), 2) '[0,60]å æ¯”'
from Score s
left join Course c
on s.c_id = c.c_id
group by s.c_id, c.c_name;    -- åˆ†è¯¾ç¨‹ç»Ÿè®¡æ€»æ•°å’Œå æ¯”
```

![](https://tva1.sinaimg.cn/large/0081Kckwgy1gkwmfpko5kj31my0rcdlj.jpg)



### é¢˜ç›®24

#### é¢˜ç›®éœ€æ±‚

æŸ¥è¯¢å­¦ç”Ÿçš„å¹³å‡æˆç»©åŠåæ¬¡

#### SQLå®ç°

##### è‡ªå·±çš„æ–¹æ³•

1ã€å…ˆæ±‚å‡ºæ¯ä¸ªäººçš„å¹³å‡åˆ†

```sql
-- è‡ªå·±çš„æ–¹æ³•

select 
	sc.s_id
	,s.s_name
	,round(avg(sc.s_score),2)  avg_score
from Score sc
join Student s
on sc.s_id=s.s_id
group by sc.s_id,s.s_name
```

![](https://tva1.sinaimg.cn/large/0081Kckwgy1gkwmrdth8yj30pq0nkdi7.jpg)

2ã€æˆ‘ä»¬å¯¹ä¸Šé¢çš„ç»“æœè¿›è¡Œæ’åº

ï¼ï¼ï¼**MySQL5ä¸­æ˜¯æ²¡æœ‰rankå‡½æ•°çš„ï¼Œéœ€è¦è‡ªå·±å®ç°æ’åºåŠŸèƒ½**

```sql
-- MYSQL5.7ä¸­æ²¡æœ‰rankå‡½æ•°ï¼Œæ‰€ä»¥é€šè¿‡è‡ªè¿æ¥å®ç°

select
	t1.s_id
	,t1.s_name
	,t1.avg_score
	,(select count(distinct t2.avg_score) 
		from (select 
            sc.s_id
            ,s.s_name
            ,round(avg(sc.s_score),2)  avg_score
          from Score sc
          join Student s
          on sc.s_id=s.s_id
          group by sc.s_id,s.s_name)t2    -- ä¸´æ—¶è¡¨t2ä¹Ÿæ˜¯ä¸Šé¢çš„ç»“æœ
		where t2.avg_score >= t1.avg_score
		) rank

from (select 
        sc.s_id
        ,s.s_name
        ,round(avg(sc.s_score),2)  avg_score
      from Score sc
      join Student s
      on sc.s_id=s.s_id
      group by sc.s_id,s.s_name)t1   -- ä¸´æ—¶è¡¨t1å°±æ˜¯ä¸Šé¢çš„ç»“æœ
order by t1.avg_score desc;
```

![](https://tva1.sinaimg.cn/large/0081Kckwgy1gkwn5atqzsj30my0ee75l.jpg)

##### å‚è€ƒæ–¹æ³•

```sql
select
	a.s_id  -- å­¦å·
	,@i:=@i+1 as 'ä¸ä¿ç•™ç©ºç¼ºæ’å'   -- ç›´æ¥içš„è‡ªåŠ 
	,@k:=(case when @avg_score=a.avg_s then @k else @i end) as 'ä¿ç•™ç©ºç¼ºæ’å'
	,@avg_score:=avg_s as 'å¹³å‡åˆ†'  -- è¡¨aä¸­çš„å€¼

from (select 
      	s_id
      	,round(avg(s_score), 2) as avg_s
      from Score 
      group by s_id
      order by 2 desc)a    -- è¡¨aï¼šå¹³å‡æˆç»©çš„æ’åºå’Œå­¦å·
      ,(select @avg_score:=0, @i:=0, @k:=0)b   -- è¡¨bï¼šé€šè¿‡å˜é‡è®¾ç½®åˆå§‹å€¼
```

![](https://tva1.sinaimg.cn/large/0081Kckwgy1gkwuk9x958j31860teq6t.jpg)

### å®ç°rankå‡½æ•°

```sql
select 
	s.s_name  -- å§“å
	,s.s_score  -- æˆç»©
	,(select count(distinct t2.s_score)
    from Score t2
    where t2.s_score >= t1.s_score) rank   -- åœ¨t2åˆ†æ•°å¤§çš„æƒ…å†µä¸‹ï¼Œç»Ÿè®¡t2çš„å»é‡ä¸ªæ•°
from Score t1
order by t1.s_score desc;   -- åˆ†æ•°é™åºæ’åˆ—
```

ä¸¾ä¾‹å­æ¥è¯´æ˜è¿™ä¸ªè„šæœ¬ï¼š

| å§“å | æˆç»© |
| ---- | ---- |
| å¼ ä¸‰ | 89   |
| æå›› | 90   |
| ç‹äº” | 78   |
| å°æ˜ | 98   |
| å°çº¢ | 60   |

1. å½“t1.s_score=89ï¼Œæ»¡è¶³t2.s_score > = t1.s_scoreçš„æœ‰**98ï¼Œ90å’Œ89**ï¼Œæ­¤æ—¶count(distinct t2.s_score) çš„ä¸ªæ•°å°±æ˜¯3
2. å½“t1.s_score=90ï¼Œæ»¡è¶³t2.s_score > = t1.s_scoreçš„æœ‰**98å’Œ90**ï¼Œæ­¤æ—¶count(distinct t2.s_score) çš„ä¸ªæ•°å°±æ˜¯2
3. å½“t1.s_score=78ï¼Œæ»¡è¶³t2.s_score > = t1.s_scoreçš„æœ‰**98ã€90ã€89å’Œ78**ï¼Œæ­¤æ—¶count(distinct t2.s_score) çš„ä¸ªæ•°å°±æ˜¯4
4. å½“t1.s_score=98ï¼Œæ»¡è¶³t2.s_score > = t1.s_scoreçš„åªæœ‰**98**ï¼Œæ­¤æ—¶count(distinct t2.s_score) çš„ä¸ªæ•°å°±æ˜¯1
5. å½“t1.s_score=60ï¼Œæ»¡è¶³t2.s_score > = t1.s_scoreçš„**æœ‰89ã€90ã€78ã€98ã€60**ï¼Œæ­¤æ—¶count(distinct t2.s_score) çš„ä¸ªæ•°å°±æ˜¯5

é€šè¿‡ä¸Šé¢çš„æ­¥éª¤ï¼Œæˆ‘ä»¬å‘ç°ï¼š**t1ä¸­æ¯ä¸ªåˆ†æ•°å¯¹åº”çš„ä¸ªæ•°å°±æ˜¯å®ƒçš„æ’å**

### é¢˜ç›®25

#### é¢˜ç›®éœ€æ±‚

æŸ¥è¯¢å„ç§‘æˆç»©å‰ä¸‰åçš„è®°å½•

#### SQLå®ç°

##### è‡ªå·±çš„æ–¹æ³•

1ã€é¦–å…ˆæˆ‘ä»¬æ‰¾å‡ºè¯­æ–‡çš„å‰3å

```sql
select s.s_id, s.s_score, c.c_name
from Score s
join Course c on s.c_id = c.c_id
where c.c_name = 'è¯­æ–‡'
order by s.s_score desc   -- é™åºä¹‹åå–å‡ºå‰3æ¡è®°å½•
limit 3;
```

![](https://tva1.sinaimg.cn/large/0081Kckwgy1gkwv06hl7ij30o20k6q4w.jpg)

![](https://tva1.sinaimg.cn/large/0081Kckwgy1gkwv0wa0wuj30wk0gydhw.jpg)

2ã€é€šè¿‡åŒæ ·çš„æ–¹æ³•æˆ‘ä»¬å¯ä»¥æ±‚å‡ºæ•°å­¦å’Œè‹±è¯­çš„å‰3æ¡è®°å½•ï¼Œç„¶åé€šè¿‡unionè¿›è¡Œè”ç»“ï¼Œæœ‰å¾…ä¼˜åŒ–ğŸ˜­

```sql
-- è‡ªå·±çš„è„šæœ¬

(select s.s_id, s.s_score, c.c_name
from Score s
join Course c on s.c_id = c.c_id
where c.c_name = 'è¯­æ–‡'
order by s.s_score desc   -- é™åºä¹‹åå–å‡ºå‰3æ¡è®°å½•
limit 3)

union

(select s.s_id, s.s_score, c.c_name
from Score s
join Course c on s.c_id = c.c_id
where c.c_name = 'æ•°å­¦'
order by s.s_score desc   
limit 3)

union

(select s.s_id, s.s_score, c.c_name
from Score s
join Course c on s.c_id = c.c_id
where c.c_name = 'è‹±è¯­'
order by s.s_score desc   
limit 3)
```

![](https://tva1.sinaimg.cn/large/0081Kckwgy1gkwv4byilcj30tw18i0xn.jpg)

##### å‚è€ƒæ–¹æ³•

é€šè¿‡Scoreè¡¨çš„è‡ªè¿æ¥ï¼Œè¡¨aä¸­çš„å€¼å°äºè¡¨bä¸­çš„å€¼ï¼Œæ’åºä¹‹åæˆ‘ä»¬å–å‰3

```sql
select
	a.s_id
	,a.c_id
	,a.s_score   -- å–å‡ºaä¸­çš„æˆç»©
from Score a
join Score b
on a.c_id = b.c_id
and a.s_score <= b.s_score   -- è¡¨bä¸­çš„æˆç»©å¤§
group by 1,2,3
having count(b.s_id) = 3
order by 2, 3 desc;
```

æˆ‘ä»¬é€šè¿‡`è¯­æ–‡`è¿™ä¸ªç§‘ç›®æ¥ç†è§£ä¸Šé¢çš„ä»£ç ï¼š**å‰3åæ˜¯80ï¼Œ80ï¼Œ76**

![](https://tva1.sinaimg.cn/large/0081Kckwgy1gkwwf45tgmj30pm0egwfo.jpg)

```sql
-- è¯­æ–‡
select
	a.s_id
	,a.c_id
	,a.s_score   -- 3ã€æ­¤æ—¶aè¡¨çš„æˆç»©å°±æ˜¯æˆ‘ä»¬æ‰¾çš„  
from Score a
join Score b
on a.c_id = b.c_id
and a.s_score <= b.s_score  -- 1ã€åˆ¤æ–­açš„åˆ†æ•°å°äºç­‰äºbçš„åˆ†æ•°ï¼Œè¦å¸¦ä¸Šç­‰å·
and a.c_id="01"
group by 1,2
having count(b.s_id) <= 3  -- 2ã€bä¸­çš„ä¸ªæ•°è‡³å°‘æœ‰3ä¸ªï¼Œåº”å¯¹åˆ†æ•°ç›¸åŒçš„æƒ…å½¢
order by 3 desc;   
```

![](https://tva1.sinaimg.cn/large/0081Kckwgy1gkwww41mkdj30ou0notaw.jpg)

```sql
-- è¯­æ–‡

select
	a.s_id
	,a.c_id
	,a.s_score   -- aè¡¨çš„æˆç»©
from Score a
join Score b
on a.c_id = b.c_id
and a.s_score <= b.s_score   -- 1ã€åˆ¤æ–­açš„åˆ†æ•°å°äºç­‰äºbçš„åˆ†æ•°ï¼Œè¦å¸¦ä¸Šç­‰å·
group by 1,2,3
having count(b.s_id) <= 3   -- 2ã€bä¸­çš„ä¸ªæ•°è‡³å°‘æœ‰3ä¸ªï¼Œåº”å¯¹åˆ†æ•°ç›¸åŒçš„æƒ…å½¢
order by 2, 3 desc;   -- è¯¾ç¨‹ï¼ˆ2ï¼‰çš„å‡åºï¼Œæˆç»©ï¼ˆï¼‰3çš„é™åº
```

![](https://tva1.sinaimg.cn/large/0081Kckwgy1gkwx01p0fvj31160t6gou.jpg)





### é¢˜ç›®26

#### é¢˜ç›®éœ€æ±‚

æŸ¥è¯¢æ¯é—¨è¯¾è¢«é€‰ä¿®çš„å­¦ç”Ÿæ•°

#### SQLå®ç°

```sql
select 
	c.c_id
	,c.c_name
	,count(s.s_id)
from Course c
join Score s
on c.c_id = s.c_id
group by c.c_id;
```

![](https://tva1.sinaimg.cn/large/0081Kckwgy1gkwzs0go5fj30ps0imdhg.jpg)

### é¢˜ç›®27

#### é¢˜ç›®éœ€æ±‚

æŸ¥è¯¢å‡ºåªæœ‰ä¸¤é—¨è¯¾ç¨‹çš„å…¨éƒ¨å­¦ç”Ÿçš„å­¦å·å’Œå§“å

#### SQLå®ç°

havingæ¡ä»¶æ˜¯åˆ†ç»„ä¹‹ååœ¨æ‰§è¡Œçš„ï¼Œwhereè¯­å¥æ˜¯åˆ†ç»„å‰å…ˆæ‰§è¡Œçš„

```sql
select 
	s.s_id
	,s.s_name
from Student s
join Score sc
on s.s_id = sc.s_id
group by 1,2
having count(sc.c_id) = 2;
```

![](https://tva1.sinaimg.cn/large/0081Kckwgy1gkx01uol6qj30mm0iqwg9.jpg)

### é¢˜ç›®28

#### é¢˜ç›®éœ€æ±‚

æŸ¥è¯¢ç”·å¥³ç”Ÿäººæ•°

#### SQLå®ç°

å…ˆçœ‹çœ‹æ•°æ®ï¼šç”·å¥³äººæ•°éƒ½æ˜¯4

![](https://tva1.sinaimg.cn/large/0081Kckwgy1gkx05916wrj30mu0h0tal.jpg)

```sql
--  è‡ªå·±çš„æ–¹æ³•
select 
	count(case when s_sex='ç”·' then 1 end) as 'ç”·'
	,count(case when s_sex='å¥³' then 1 end) as 'å¥³'
from Student;

-- å‚è€ƒæ–¹æ³•
select 
	s_sex
	,count(s_sex) as `äººæ•°`
from Student
group by s_sex;
```

![](https://tva1.sinaimg.cn/large/0081Kckwgy1gkx0c504euj30tq0c4wfg.jpg)

![](https://tva1.sinaimg.cn/large/0081Kckwgy1gkx0e7thvlj30kc0g6t9w.jpg)

### é¢˜ç›®29

#### é¢˜ç›®éœ€æ±‚

æŸ¥è¯¢åå­—ä¸­å«æœ‰`é£`å­—çš„å­¦ç”Ÿä¿¡æ¯

#### SQLå®ç°

å…ˆçœ‹çœ‹å“ªäº›åŒå­¦çš„åå­—ä¸­æœ‰é£

![](https://tva1.sinaimg.cn/large/0081Kckwgy1gkx0hyhjzhj30os0gctam.jpg)

```sql
-- æ¨¡ç³ŠåŒ¹é…ï¼šæˆ‘ä»¬åœ¨ä¸¤è¾¹éƒ½åŠ ä¸Šäº†%ï¼Œè€ƒè™‘çš„æ˜¯å§“æˆ–è€…åå­—å«æœ‰é£ï¼Œè™½ç„¶é£å§“å¾ˆå°‘è§
select * from Student where s_name like "%é£%";
```



![](https://tva1.sinaimg.cn/large/0081Kckwgy1gkx0jayz72j30s4082751.jpg)

### é¢˜ç›®30

#### é¢˜ç›®éœ€æ±‚

æŸ¥è¯¢åŒååŒæ€§çš„å­¦ç”Ÿåå•ï¼Œå¹¶ç»Ÿè®¡åŒåäººæ•°

#### SQLå®ç°

1ã€å…ˆçœ‹çœ‹ç­çº§çš„å­¦ç”Ÿä¿¡æ¯

![](https://tva1.sinaimg.cn/large/0081Kckwgy1gkx0nwfc2nj30nw0godhq.jpg)

ç°æœ‰çš„æ•°æ®ä¸­æ²¡æœ‰åŒåçš„å­¦ç”Ÿï¼Œä½†æ˜¯å½“ç­çº§äººæ•°å¢å¤šçš„æ—¶å€™å¾ˆæœ‰å¯èƒ½åœ¨ç­çº§ä¸Šå‡ºç°åŒåçš„å­¦ç”Ÿ

2ã€å‡è®¾æœ‰åŒååŒæ€§çš„å­¦ç”Ÿ

```sql
select 
	a.s_name
	,a.s_sex
	,count(*)
from Student a  -- åŒä¸€ä¸ªè¡¨çš„è‡ªè¿æ¥
join Student b
on a.s_id != b.s_id   -- è¿æ¥çš„æ—¶å€™ä¸èƒ½æ˜¯åŒä¸€ä¸ªäººï¼šå­¦å·ä¿è¯ï¼Œæ¯ä¸ªäººçš„å­¦å·æ˜¯å”¯ä¸€çš„ï¼Œå…¶ä»–å­—æ®µéƒ½å¯èƒ½é‡å¤
and a.s_sex = b.s_sex  -- æ€§åˆ«ç›¸åŒ
and a.s_name = b.s_name -- åå­—ç›¸åŒ
group by 1,2;
```

![](https://tva1.sinaimg.cn/large/0081Kckwgy1gkx0zxo4z9j31a40ec0vh.jpg)



### é¢˜ç›®31

#### é¢˜ç›®éœ€æ±‚

æŸ¥è¯¢1990å¹´å‡ºç”Ÿçš„å­¦ç”Ÿä¿¡æ¯

#### SQLå®ç°

```sql
select *
from Student
where s_birth like '1990%';   -- æ¨¡ç³ŠåŒ¹é…
```

![](https://tva1.sinaimg.cn/large/0081Kckwgy1gkx1a6f528j30ok0fowg4.jpg)



### é¢˜ç›®32



#### é¢˜ç›®éœ€æ±‚

æŸ¥è¯¢æ¯é—¨è¯¾ç¨‹çš„å¹³å‡æˆç»©ï¼Œç»“æœæŒ‰å¹³å‡æˆç»©é™åºæ’åˆ—ï¼›å¹³å‡æˆç»©ç›¸åŒæ—¶ï¼ŒæŒ‰è¯¾ç¨‹ç¼–å·c_idå‡åºæ’åˆ—

#### SQLå®ç°

```sql 
-- è‡ªå·±çš„æ–¹æ³•
select 
	c_id
	,round(avg(s_score),2) avg_score
from Score
group by 1
order by 2 desc, c_id;  -- æŒ‡å®šå­—æ®µå’Œæ’åºæ–¹æ³•
```

![](https://tva1.sinaimg.cn/large/0081Kckwgy1gkx1hpht1nj30u20gwgn7.jpg)

å¦‚æœæƒ³å¸¦ä¸Šè¯¾ç¨‹çš„åç§°ï¼Œéœ€è¦å’ŒCourseè¡¨è¿›è¡Œè”ç»“

```sql
-- è‡ªå·±çš„æ–¹æ³•
select 
	c.c_id
	,c.c_name
	,round(avg(sc.s_score),2) avg_score
from Score sc
join Course c
on sc.c_id = c.c_id
group by 1,2
order by 3 desc, c.c_id;  -- æŒ‡å®šå­—æ®µå’Œæ’åºæ–¹æ³•
```

![](https://tva1.sinaimg.cn/large/0081Kckwgy1gkx1kijkrfj30tm0jmjtj.jpg)



### é¢˜ç›®33

#### é¢˜ç›®éœ€æ±‚

æŸ¥è¯¢å¹³å‡æˆç»©å¤§äºç­‰äº85çš„æ‰€æœ‰å­¦ç”Ÿçš„å­¦å·ã€å§“åå’Œå¹³å‡æˆç»©

#### SQLå®ç°

```sql
-- è‡ªå·±çš„æ–¹æ³•
select 
	sc.s_id
	,s.s_name
	,round(avg(sc.s_score),2) avg_score
from Score sc
join Student s
on sc.s_id = s.s_id
group by sc.s_id,s.s_name
having avg_score >= 85;
```

![](https://tva1.sinaimg.cn/large/0081Kckwgy1gkx1qm4198j30q80iy0ul.jpg)

### é¢˜ç›®34

#### é¢˜ç›®éœ€æ±‚

æŸ¥è¯¢è¯¾ç¨‹åç§°ä¸º**æ•°å­¦**ï¼Œä¸”åˆ†æ•°ä½äº60çš„å­¦ç”Ÿå§“åå’Œåˆ†æ•°

#### SQLå®ç°

```sql
select 
	s.s_name
	,sc.s_score
from Score sc   -- æˆç»©è¡¨
join Student s  -- å­¦ç”Ÿä¿¡æ¯è¡¨
on sc.s_id = s.s_id
join Course c  -- è¯¾ç¨‹è¡¨ï¼ŒæŒ‡å®šæ•°å­¦
on sc.c_id = c.c_id
where c.c_name = 'æ•°å­¦'
and sc.s_score < 60;  -- æŒ‡å®šæˆç»©
```

![](https://tva1.sinaimg.cn/large/0081Kckwgy1gkx21y1bzyj30os0jkdhx.jpg)

**çœ‹çœ‹çœŸæ­£çš„æ•°æ®ï¼Œçš„ç¡®åªæœ‰ä¸€ä¸ªäººæ»¡è¶³**

![](https://tva1.sinaimg.cn/large/0081Kckwgy1gkx23reca5j30se0eu0u4.jpg)

### é¢˜ç›®35

#### é¢˜ç›®éœ€æ±‚

æŸ¥è¯¢æ‰€æœ‰å­¦ç”Ÿçš„è¯¾ç¨‹åŠåˆ†æ•°æƒ…å†µ

#### SQLå®ç°

```sql
select 
	s.s_id
	,s.s_name
	,sum(case c.c_name when 'è¯­æ–‡' then sc.s_score else 0 end) as 'è¯­æ–‡'  -- è¯­æ–‡åˆ†æ•°
	,sum(case c.c_name when 'æ•°å­¦' then sc.s_score else 0 end) as 'æ•°å­¦'
	,sum(case c.c_name when 'è‹±è¯­' then sc.s_score else 0 end) as 'è‹±è¯­'
	,sum(sc.s_score) as 'æ€»åˆ†'  -- æ¯ä¸ªäººçš„æ€»åˆ†
from Student s
left join Score sc
on s.s_id = sc.s_id
left join Course c 
on sc.c_id = c.c_id
group by s.s_id, s.s_name;   -- å­¦å·å’Œå§“åçš„åˆ†ç»„
```

![](https://tva1.sinaimg.cn/large/0081Kckwgy1gkx2w15m20j313o0u0aej.jpg)



### é¢˜ç›®36

#### é¢˜ç›®éœ€æ±‚

æŸ¥è¯¢ä»»ä½•ä¸€é—¨è¯¾ç¨‹æˆç»©åœ¨70åˆ†ä»¥ä¸Šçš„å§“åã€è¯¾ç¨‹åç§°å’Œåˆ†æ•°

#### SQLå®ç°

```sql
select 
	s.s_name
	,c.c_name
	,sc.s_score
from Score sc   -- æˆç»©è¡¨
join Student s  -- å­¦ç”Ÿä¿¡æ¯è¡¨
on sc.s_id = s.s_id
join Course c  -- è¯¾ç¨‹è¡¨
on sc.c_id = c.c_id
where sc.s_score > 70
group by s.s_name, c.c_name, sc.s_score;
```

![](https://tva1.sinaimg.cn/large/0081Kckwgy1gkx3euwr4kj30qy0w0783.jpg)



### é¢˜ç›®37

#### é¢˜ç›®éœ€æ±‚

æŸ¥è¯¢ä¸åŠæ ¼çš„è¯¾ç¨‹

#### SQLå®ç°

```sql
select
	sc.c_id
	,c.c_name
	,sc.s_score
from Score sc
join Course c
on sc.c_id = c.c_id
where sc.s_score < 60;
```

![](https://tva1.sinaimg.cn/large/0081Kckwgy1gkx3aaqhwkj30mg0le762.jpg)

### é¢˜ç›®38

#### é¢˜ç›®éœ€æ±‚

æŸ¥è¯¢è¯¾ç¨‹ç¼–å·ä¸º01ä¸”è¯¾ç¨‹æˆç»©å¤§äºç­‰äº80çš„å­¦ç”Ÿçš„å­¦å·å’Œå§“å

#### SQLå®ç°

```sql
select 
	sc.s_id
	,s.s_name
	,sc.s_score
from Score sc   -- æˆç»©è¡¨
join Student s  -- å­¦ç”Ÿä¿¡æ¯è¡¨
on sc.s_id = s.s_id
join Course c  -- è¯¾ç¨‹è¡¨
on sc.c_id = c.c_id
where c.c_id = 01
and sc.s_score >= 80;
```

![](https://tva1.sinaimg.cn/large/0081Kckwgy1gkx3hsw9fcj30py0m4q53.jpg)



### é¢˜ç›®39

#### é¢˜ç›®éœ€æ±‚

æ¯é—¨è¯¾ç¨‹çš„å­¦ç”Ÿäººæ•°

#### SQLå®ç°

```sql
select 
	c_id
	,count(s_id)
from Score 
group by c_id;
```

![](https://tva1.sinaimg.cn/large/0081Kckwgy1gkx3qxjjjzj30gk0fqjsb.jpg)

å¦‚æœæƒ³è¿æ¥åˆ°è¯¾ç¨‹åç§°ï¼š

```sql
-- æŠ¥é”™ï¼ï¼ï¼
select 
	sc.c_id
	,c.c_name
	,count(sc.s_id)
from Score sc
join Course c
group by sc.c_id;
```

> ERROR 1055 (42000): Expression #2 of SELECT list is not in GROUP BY clause and contains nonaggregated column 'test.c.c_name' which is not functionally dependent on columns in GROUP BY clause; this is incompatible with sql_mode=only_full_group_by

![](https://tva1.sinaimg.cn/large/0081Kckwgy1gkx3vy7a0aj327k0bu0uu.jpg)



è§£å†³çš„æ–¹æ³•æ˜¯å°†æˆ‘ä»¬ä¹‹å‰çš„ç»“æœä½œä¸ºä¸´æ—¶è¡¨å’ŒCourseè¡¨æ¥è¿æ¥æŸ¥è¯¢ï¼š

```sql
select 
	c.c_name  è¯¾ç¨‹åç§°
	,c.c_id  è¯¾ç¨‹ç¼–å·
	,t.num  äººæ•°
from Course c
join(select 
   		 c_id
    	,count(s_id)  num
  	from Score 
  	group by c_id)t   -- ä¸Šé¢ç»“æœçš„ä¸´æ—¶è¡¨
on c.c_id = t.c_id;
```

![](https://tva1.sinaimg.cn/large/0081Kckwgy1gkx4008rlzj30li09ijs3.jpg)



### é¢˜ç›®40

#### é¢˜ç›®éœ€æ±‚

æŸ¥è¯¢é€‰ä¿®"å¼ ä¸‰"è€å¸ˆæ‰€æˆè¯¾ç¨‹çš„å­¦ç”Ÿä¸­ï¼Œæˆç»©æœ€é«˜çš„å­¦ç”Ÿä¿¡æ¯åŠå…¶æˆç»©

#### SQLå®ç°

1ã€æˆ‘ä»¬å…ˆæ‰¾å‡ºå¼ ä¸‰è€å¸ˆæ•™äº†å“ªäº›è¯¾ç¨‹

```sql
select 
	c.c_id
	,c.c_name
from Course c
join Teacher t
on c.t_id = t.t_id
where t.t_name = 'å¼ ä¸‰';
```

![](https://tva1.sinaimg.cn/large/0081Kckwgy1gkx46gry9fj30ko0f6ab4.jpg)

2ã€æ‰¾å‡ºå“ªäº›äººä¿®äº†æ•°å­¦

```sql
select 
	sc.s_id
	,sc.s_score
from Score sc
left join Course c
on sc.c_id = c.c_id
left join Teacher t
on c.t_id = t.t_id
where t.t_name = 'å¼ ä¸‰';
```

![](https://tva1.sinaimg.cn/large/0081Kckwgy1gkx4athdbyj30ra0nujtn.jpg)

3ã€é€šè¿‡maxå‡½æ•°æ‰¾å‡ºæˆç»©çš„æœ€é«˜åˆ†

```sql
select
	max(sc.s_score) 
from Score sc
left join Course c
on sc.c_id = c.c_id
left join Teacher t
on c.t_id = t.t_id
where t.t_name = 'å¼ ä¸‰';
```

![](https://tva1.sinaimg.cn/large/0081Kckwgy1gkx4kkl0w3j30m60gsabe.jpg)

4ã€è¿æ¥Studentè¡¨ï¼Œæ‰¾å‡ºå­¦ç”Ÿä¿¡æ¯

```sql
select
	s.*
	,sc.s_score
	,sc.c_id
	,c.c_name
from Student s
left join Score sc
on s.s_id = sc.s_id
left join Course c
on sc.c_id = c.c_id
where sc.s_score in (select max(sc.s_score)    -- æœ€å¤§å€¼90åˆ†çš„ç¡®å®š
                    from Score sc
                    left join Course c
                    on sc.c_id = c.c_id
                    left join Teacher t
                    on c.t_id = t.t_id
                    where t.t_name = 'å¼ ä¸‰');
```

![](https://tva1.sinaimg.cn/large/0081Kckwgy1gkx4wo1mxrj313y0r0gov.jpg)





### é¢˜ç›®41

#### é¢˜ç›®éœ€æ±‚

æŸ¥è¯¢ä¸åŒè¯¾ç¨‹æˆç»©ç›¸åŒçš„å­¦ç”Ÿçš„å­¦ç”Ÿç¼–å·ã€è¯¾ç¨‹ç¼–å·ã€å­¦ç”Ÿæˆç»©

#### SQLå®ç°

```sql
select
	a.s_id
	,a.c_id
	,a.s_score
from Score a
join Score b
on a.c_id != b.c_id
and a.s_score = b.s_score
and a.s_id != b.s_id;
```

![image-20201122001411784](https://tva1.sinaimg.cn/large/0081Kckwgy1gkx901q3h2j30pi0lcjt2.jpg)

æˆ‘ä»¬å¯¹å­¦å·è¿˜éœ€è¦å»é‡ä¸‹ï¼š

```sql
select
	distinct a.s_id
	,a.c_id
	,a.s_score
from Score a
join Score b
on a.c_id != b.c_id
and a.s_score = b.s_score
and a.s_id != b.s_id;
```

![](https://tva1.sinaimg.cn/large/0081Kckwgy1gkx90x1us9j30pg0kq0uc.jpg)

å†çœ‹çœ‹åŸå§‹çš„æ•°æ®ä¸­æ˜¯å¦ç¬¦åˆè¦æ±‚ï¼š

![](https://tva1.sinaimg.cn/large/0081Kckwgy1gkx936d7e2j30ku0qy40e.jpg)



### é¢˜ç›®42

#### é¢˜ç›®éœ€æ±‚

æŸ¥è¯¢æ¯é—¨åŠŸæˆç»©æœ€å¥½çš„å‰ä¸¤å

#### SQLå®ç°

##### è‡ªå·±çš„æ–¹æ³•

è¿˜éœ€è¦å¥½å¥½ä¼˜åŒ–çš„ğŸ˜­

```sql
-- å…ˆæ‰¾å‡ºè¯­æ–‡çš„å‰2ååŒå­¦

select 
	c.c_id
	,sc.s_id
	,sc.s_score	
from Score sc
join Course c
on sc.c_id = c.c_id
where c.c_name = 'è¯­æ–‡'   -- æ”¹æˆæ•°å­¦å’Œè‹±è¯­å³å¯æ±‚å‡ºç›¸åº”çš„ä¿¡æ¯
order by sc.s_score desc
limit 2;
```

![](https://tva1.sinaimg.cn/large/0081Kckwgy1gkx9dv5ttmj30z40k8ac2.jpg)

å°†3é—¨å­¦ç§‘çš„ä¿¡æ¯è¿›è¡Œæ‹¼æ¥å³å¯æ±‚å‡ºç­”æ¡ˆï¼š

```sql
-- æœ€ç»ˆè„šæœ¬

(select 
	c.c_id
	,sc.s_id
	,sc.s_score	
from Score sc
join Course c
on sc.c_id = c.c_id
where c.c_name = 'è¯­æ–‡'   
order by sc.s_score desc
limit 2)

union

(select 
	c.c_id
	,sc.s_id
	,sc.s_score	
from Score sc
join Course c
on sc.c_id = c.c_id
where c.c_name = 'æ•°å­¦'   
order by sc.s_score desc
limit 2)

union

(select 
	c.c_id
	,sc.s_id
	,sc.s_score	
from Score sc
join Course c
on sc.c_id = c.c_id
where c.c_name = 'è‹±è¯­' 
order by sc.s_score desc
limit 2)
```

![](https://tva1.sinaimg.cn/large/0081Kckwgy1gkx9gmhjx3j30hw0di750.jpg)



##### å‚è€ƒæ–¹æ³•ï¼ˆå¥½æ–¹æ³•ï¼‰

å¦‚ä½•è§£å†³å‰å‡ åæ’åºçš„é—®é¢˜ğŸ‚ğŸºğŸš—å¤ªç‰›äº†

```sql
select 
	a.c_id
	,a.s_id
	,a.s_score
from Score a
where (select count(1)   -- count(1)ç±»ä¼¼count(*)ï¼šç»Ÿè®¡è¡¨bä¸­åˆ†æ•°å¤§çš„æ•°é‡
       from Score b 
       where b.c_id=a.c_id   -- è¯¾ç¨‹ç›¸åŒ
       and b.s_score >= a.s_score) <= 2   -- å‰2å
order by a.c_id;
```

![](https://tva1.sinaimg.cn/large/0081Kckwgy1gkx9l1mwhyj31ey0l6gns.jpg)

é¦–å…ˆæˆ‘ä»¬çœ‹çœ‹çœŸå®çš„æ•°æ®ï¼Œæˆ‘ä»¬ä»¥01è¯¾ç¨‹æ¥è¿›è¡Œè§£é‡Šä¸Šé¢çš„ä»£ç ï¼š

![](https://tva1.sinaimg.cn/large/0081Kckwgy1gkxogq99jpj318o0f2402.jpg)

ç¬¦åˆè¦æ±‚`count(1)<=2`çš„åªæœ‰ä¸¤ç§æƒ…å†µ

![](https://tva1.sinaimg.cn/large/0081Kckwgy1gkxo68apdvj30za0sqgo1.jpg)

è¿˜éœ€è¦å¥½å¥½ç†è§£ä¸‹ğŸ˜­



### é¢˜ç›®43

#### é¢˜ç›®éœ€æ±‚

ç»Ÿè®¡æ¯é—¨è¯¾ç¨‹çš„å­¦ç”Ÿé€‰ä¿®äººæ•°ï¼ˆè¶…è¿‡5äººçš„è¯¾ç¨‹æ‰ç»Ÿè®¡ï¼‰ã€‚è¦æ±‚è¾“å‡ºè¯¾ç¨‹å·å’Œé€‰ä¿®äººæ•°ï¼ŒæŸ¥è¯¢ç»“æœæŒ‰äººæ•°é™åºæ’åˆ—ï¼Œè‹¥äººæ•°ç›¸åŒï¼ŒæŒ‰è¯¾ç¨‹å·å‡åºæ’åˆ—

#### SQLå®ç°

```sql
select 
	c_id
	,count(s_score) num
from Score 
group by c_id
having num > 5
order by num desc, c_id;
```

![](https://tva1.sinaimg.cn/large/0081Kckwgy1gkxpfmw48rj30n20hs3zz.jpg)



### é¢˜ç›®44

#### é¢˜ç›®éœ€æ±‚

æ£€ç´¢è‡³å°‘é€‰ä¿®ä¸¤é—¨è¯¾ç¨‹çš„å­¦ç”Ÿå­¦å·

#### SQLå®ç°

ç»“æœæ˜¾ç¤ºå…¨éƒ¨æ»¡è¶³è¦æ±‚

```sql
select  
	s_id
	,count(*) num
from Score 
group by s_id
having num >= 2;   
```

![](https://tva1.sinaimg.cn/large/0081Kckwgy1gkxpkjduwjj30ie0logmv.jpg)



### é¢˜ç›®45

#### é¢˜ç›®éœ€æ±‚

æŸ¥è¯¢é€‰ä¿®äº†å…¨éƒ¨è¯¾ç¨‹çš„å­¦ç”Ÿä¿¡æ¯

#### SQLå®ç°

#### è‡ªå·±çš„æ–¹æ³•

1ã€å…¨éƒ¨çš„è¯¾ç¨‹æ•°ç›®num

```sql
select count(*) from Course;   -- æ€»å…±3é—¨
```

![image-20201122095253954](https://tva1.sinaimg.cn/large/0081Kckwgy1gkxpq1e557j30jk08ijrs.jpg)

2ã€ä»Scoreè¡¨åˆ†ç»„ç»Ÿè®¡æ¯ä¸ªäººçš„è¯¾ç¨‹æ•°ç›®ï¼Œæ»¡è¶³æ˜¯3çš„å­¦ç”Ÿä¿¡æ¯

```sql
select 
	s_id
	,count(c_id) num   -- è¯¾ç¨‹æ•°ç›®
from Score
group by s_id
having num in (select count(*)  
               from Course); --æ»¡è¶³å…¨éƒ¨è¯¾ç¨‹
```

![](https://tva1.sinaimg.cn/large/0081Kckwgy1gkxputtukdj30sk0iywg6.jpg)

3ã€æˆ‘ä»¬æ‰¾å‡ºä¸Šé¢ç»“æœä¸­çš„å­¦ç”Ÿä¿¡æ¯å³å¯

```sql
select 
	s.*
	,count(c_id) num   -- è¯¾ç¨‹æ•°ç›®
from Score sc
join Student s
on sc.s_id = s.s_id
group by s.s_id
having num in (select count(*)  
               from Course); --æ»¡è¶³å…¨éƒ¨è¯¾ç¨‹
```

![](https://tva1.sinaimg.cn/large/0081Kckwgy1gkxpybx2k4j30sk0lkgo7.jpg)

##### å‚è€ƒæ–¹æ³•

```sql
select *   -- 3ã€s_idå¯¹åº”çš„å­¦ç”Ÿä¿¡æ¯
from Student 
where s_id in(select s_id -- 2ã€æœ€å¤§è¯¾ç¨‹æ•°å¯¹åº”çš„s_id
              from Score 
              group by s_id 
              having count(*)=(select count(*) from Course)  -- 1ã€å…¨éƒ¨è¯¾ç¨‹æ•°
             )
```

### é¢˜ç›®46

#### é¢˜ç›®éœ€æ±‚

æŸ¥è¯¢å„å­¦ç”Ÿçš„å¹´é¾„ï¼šæŒ‰ç…§å‡ºç”Ÿæ—¥æœŸæ¥ç®—ï¼Œå½“å‰æœˆæ—¥ < å‡ºç”Ÿå¹´æœˆçš„æœˆæ—¥åˆ™ï¼Œå¹´é¾„å‡1

[å‚è€ƒèµ„æ–™](https://blog.csdn.net/qq2712193/article/details/48766575?utm_medium=distribute.pc_aggpage_search_result.none-task-blog-2~all~sobaiduend~default-2-48766575.nonecase&utm_term=mysql%20%E6%AF%94%E8%BE%83%E4%B8%A4%E4%B8%AA%E6%97%A5%E6%9C%9F%E7%9A%84%E5%A4%A7%E5%B0%8F&spm=1000.2123.3001.4430)



#### SQLå®ç°

##### è‡ªå·±çš„æ–¹æ³•

```sql
-- è‡ªå·±çš„æ–¹æ³•

select *
	,case when dayofyear(now()) >= dayofyear(s_birth) then year(now()) - year(s_birth) 
		when dayofyear(now()) < dayofyear(s_birth) then year(now()) - year(s_birth) - 1
	else 'other' end as 'age'
from Student;
```

![](https://tva1.sinaimg.cn/large/0081Kckwgy1gkxrm26affj30qm0f4q52.jpg)

##### å‚è€ƒæ–¹æ³•

```sql
select
	s_name
	,s_birth
	,date_format(now(), '%Y') - date_format(s_birth, '%Y') - (case when date_format(now(), '%m%d') > date_format(s_birth, '%m%d') then 0 else 1 end) as age  -- å½“å‰æ—¥æœŸå¤§ï¼Œè¯´æ˜å·²ç»è¿‡ç”Ÿäº†ï¼Œå¹´é¾„æ­£å¸¸ï¼›åä¹‹è¯´æ˜ä»Šå¹´è¿˜æ²¡æœ‰åˆ°å¹´é¾„-1
from Student;
```

![](https://tva1.sinaimg.cn/large/0081Kckwgy1gkxs5837vlj327g0ncn12.jpg)

#### å¦‚ä½•è¿”å›å¹´ä»½/æ—¥æœŸ

é€šè¿‡`date_format`å‡½æ•°èƒ½å¤ŸæŒ‡å®šè¿”å›çš„æ•°æ®

```sql
-- ä¸¤ä¸ªæ–¹æ³•

select year(now());
select date_format(now(), '%Y');
```



![](https://tva1.sinaimg.cn/large/0081Kckwgy1gkxrsztchzj30i607kaad.jpg)

![](https://tva1.sinaimg.cn/large/0081Kckwgy1gkxrsgpgqvj30ly0900tc.jpg)

è¿”å›å…·ä½“çš„æ—¥æœŸï¼š

![](https://tva1.sinaimg.cn/large/0081Kckwgy1gkxrwk3e3vj30xo0gqwfs.jpg)



### é¢˜ç›®47

#### é¢˜ç›®éœ€æ±‚

æŸ¥è¯¢æœ¬å‘¨è¿‡ç”Ÿæ—¥çš„å­¦ç”Ÿ

```sql
select week(now());   -- 47
```

1. DAYOFWEEK(date)

è¿”å›æ—¥æœŸdateçš„æ˜ŸæœŸç´¢å¼•(1=æ˜ŸæœŸå¤©ï¼Œ2=æ˜ŸæœŸä¸€, â€¦â€¦7=æ˜ŸæœŸå…­)ï¼Œç¬¦åˆå›½å†…æ ‡å‡†

2. WEEKDAY(date)

è¿”å›dateçš„æ˜ŸæœŸç´¢å¼•(0=æ˜ŸæœŸä¸€ï¼Œ1=æ˜ŸæœŸäºŒ, â€¦â€¦6= æ˜ŸæœŸå¤©)ï¼Œå›½å¤–æ ‡å‡†

#### SQLå®ç°

##### è‡ªå·±çš„æ–¹æ³•

```sql
select *
from Student
where week(s_birth) = week(now());
```

![](https://tva1.sinaimg.cn/large/0081Kckwgy1gkxsf63himj30rc0mygoi.jpg)

##### å‚è€ƒæ–¹æ³•

```sql
select * from Student where week(date_format(now(),'%Y%m%d')) = week(s_birth);  -- æ–¹å¼1

select * from student where yearweek(s_birth) = yearweek(date_format(now(),'%Y%m%d'));   -- æ–¹å¼2
```



### é¢˜ç›®48

#### é¢˜ç›®éœ€æ±‚

æŸ¥è¯¢ä¸‹å‘¨è¿‡ç”Ÿæ—¥çš„å­¦ç”Ÿ

#### SQLå®ç°

```sql
-- è‡ªå·±çš„æ–¹æ³•
select *
from Student
where week(s_birth) = week(now()) + 1;   -- å¾€å‰æ¨1å‘¨

-- å‚è€ƒæ–¹æ³•
select * from Student where week(date_format(now(),'%Y%m%d')) + 1= week(s_birth); 
```

![](https://tva1.sinaimg.cn/large/0081Kckwgy1gkxvh40ijij30v20as3zk.jpg)

#### è¾¹ç•Œé—®é¢˜

**å¦‚æœç°åœ¨åˆšå¥½çš„æ˜¯ä»Šå¹´çš„æœ€åä¸€ä¸ªå‘¨ï¼Œé‚£ä¹ˆä¸‹å‘¨å°±æ˜¯æ˜å¹´çš„ç¬¬ä¸€ä¸ªå‘¨**ï¼Œæˆ‘ä»¬å¦‚ä½•è§£å†³è¿™ä¸ªé—®é¢˜å‘¢ï¼Ÿï¼Ÿæ”¹è¿›åçš„è„šæœ¬ï¼š

```sql
-- è‡ªå·±çš„æ–¹æ³•

select * from Student
where mod(week(now()), 52) + 1 =  week(s_birth);
```

å½“ç°åœ¨åˆšå¥½æ˜¯ç¬¬52å‘¨ï¼Œé‚£ä¹ˆmodå‡½æ•°çš„ç»“æœæ˜¯0ï¼Œåˆ™è¯´æ˜å‡ºç”Ÿçš„æœˆä»½åˆšå¥½æ˜¯æ˜å¹´çš„ç¬¬ä¸€å‘¨



### é¢˜ç›®49

#### é¢˜ç›®éœ€æ±‚

æŸ¥è¯¢æœ¬æœˆè¿‡ç”Ÿçš„åŒå­¦

![image-20201122131328760](https://tva1.sinaimg.cn/large/0081Kckwgy1gkxvivtnzaj30hq094dg8.jpg)

#### SQLå®ç°

```sql
-- è‡ªå·±çš„æ–¹æ³•
select *
from Student
where month(s_birth) = month(now());

-- å‚è€ƒæ–¹æ³•
select * from Student where month(date_format(now(), '%Y%m%d')) = month(s_birth);
```

![](https://tva1.sinaimg.cn/large/0081Kckwgy1gkxvkdr4e1j30nk05sgm1.jpg)

è¿”å›çš„æ˜¯ç©ºå€¼ï¼Œæ˜¯å› ä¸ºæ•°æ®æœ¬èº«å°±æ²¡æœ‰åœ¨11æœˆä»½å‡ºç”Ÿçš„åŒå­¦

![](https://tva1.sinaimg.cn/large/0081Kckwgy1gkxvlrvuewj30py0gytaw.jpg)



### é¢˜ç›®50

#### é¢˜ç›®éœ€æ±‚

æŸ¥è¯¢ä¸‹æœˆè¿‡ç”Ÿçš„åŒå­¦

#### SQLå®ç°

```sql
-- è‡ªå·±çš„æ–¹æ³•
select * from Student
where month(s_birth) = month(now()) + 1;  -- æ¨è¿Ÿä¸€ä¸ªæœˆ

-- å‚è€ƒæ–¹æ³•
select * from Student
where month(date_format(now(), '%Y%m%d')) + 1= month(s_birth);
```

![](https://tva1.sinaimg.cn/large/0081Kckwgy1gkxvxxy2gwj30vu0bg75g.jpg)

#### è¾¹ç•Œé—®é¢˜

å‡è®¾ç°åœ¨æ˜¯12æœˆä»½ï¼Œé‚£ä¹ˆä¸‹ä¸ªæœˆå°±æ˜¯æ˜å¹´çš„1æœˆä»½ï¼Œæˆ‘ä»¬å¦‚ä½•è§£å†³ï¼Ÿï¼Ÿï¼Ÿå°†ä¸Šé¢çš„ä»£ç è¿›è¡Œæ”¹è¿›ï¼š

```sql
select * from Student
where mod(month(now()),12)  + 1 =  month(s_birth);
```

![](https://tva1.sinaimg.cn/large/0081Kckwgy1gkxw3jekinj30v40bagmx.jpg)

å¦‚æœç°åœ¨æ˜¯12æœˆä»½ï¼Œåˆ™modå‡½æ•°çš„ç»“æœæ˜¯0ï¼Œè¯´æ˜ç”Ÿæ—¥åˆšå¥½æ˜¯1æœˆä»½

