---
title: MySQL50-7-ç¬¬21-25é¢˜
top: false
cover: false
toc: true
mathjax: true
copyright: true
date: 2020-11-21 17:45:11
password:
summary:
tags:
  - MySQL
  - æ•°æ®åº“
categories:
  - MySQL
  - 50é¢˜
---



### MySQL50-7-ç¬¬11-25é¢˜

æœ¬æ–‡ä¸­ä»‹ç»çš„æ˜¯ç¬¬11-25é¢˜ç›®ï¼Œä¸»è¦æ¶‰åŠçš„çŸ¥è¯†ç‚¹æ˜¯ï¼š

- åˆ†ç»„ç»Ÿè®¡æ±‚å’Œä¸ç™¾åˆ†æ¯”
- å¦‚ä½•åˆ©ç”¨SQLå®ç°æ’åº
- havingä½¿ç”¨
- unionæ‹¼æ¥

5ä¸ªé¢˜ç›®åˆ†åˆ«æ˜¯
- æŸ¥è¯¢ä¸åŒ**è€å¸ˆ**æ‰€æ•™ä¸åŒ**è¯¾ç¨‹å¹³å‡åˆ†**ä»é«˜åˆ°ä½æ˜¾ç¤º
- æŸ¥è¯¢æ‰€æœ‰è¯¾ç¨‹çš„æˆç»©ç¬¬2ååˆ°ç¬¬3åçš„å­¦ç”Ÿä¿¡æ¯åŠè¯¥è¯¾ç¨‹æˆç»©
- ç»Ÿè®¡å„ç§‘æˆç»©å„åˆ†æ•°æ®µäººæ•°ï¼šè¯¾ç¨‹ç¼–å·ï¼Œè¯¾ç¨‹åç§°ï¼Œ[100-85]ï¼Œ[85-70]ï¼Œ[70-60]ï¼Œ[0-60]åŠæ‰€å ç™¾åˆ†æ¯”
- æŸ¥è¯¢å­¦ç”Ÿçš„å¹³å‡æˆç»©åŠåæ¬¡
- æŸ¥è¯¢å„ç§‘æˆç»©å‰ä¸‰åçš„è®°å½•

![](https://tva1.sinaimg.cn/large/0081Kckwgy1gkgmq9quckj31d20gu0wv.jpg)


<!--MORE-->

### é¢˜ç›®21

![](https://tva1.sinaimg.cn/large/0081Kckwgy1gkgmq9quckj31d20gu0wv.jpg)

#### é¢˜ç›®éœ€æ±‚

æŸ¥è¯¢ä¸åŒ**è€å¸ˆ**æ‰€æ•™ä¸åŒ**è¯¾ç¨‹å¹³å‡åˆ†**ä»é«˜åˆ°ä½æ˜¾ç¤º

#### åˆ†æè¿‡ç¨‹

æ¶‰åŠåˆ°çš„è¡¨ä¸»è¦æ˜¯

è€å¸ˆï¼šTeacher

è¯¾ç¨‹ï¼šCourseï¼Œä½œä¸ºä¸»è¡¨

æˆç»©ï¼šScore

**é€šè¿‡3ä¸ªè¡¨çš„è¿æ¥æ±‚å‡ºæ¥å³å¯**

#### SQLå®ç°

å…ˆæ‰¾å‡ºæ¯ä¸ªè€å¸ˆæ•™æˆäº†å“ªäº›è¯¾ç¨‹ï¼š

```sql
select
	c.c_name
	,t.t_name
from Course c
left join Teacher t
on c.t_id = t.t_id;
```

![](https://tva1.sinaimg.cn/large/0081Kckwgy1gkuw9x3zcyj30is0ieq48.jpg)

å°†ä¸Šé¢çš„ç»“æœå’Œ**æˆç»©è¡¨**è¿æ¥èµ·æ¥ï¼š

```sql
select
	c.c_name
	,t.t_name
	,round(avg(s.s_score),2)  score   -- è¯¾ç¨‹åˆ†ç»„åå†æ±‚å‡å€¼
from Course c   -- ä¸»è¡¨ï¼Œé€šè¿‡ä¸¤æ¬¡è¿æ¥
left join Teacher t
on c.t_id = t.t_id
left join Score s
on c.c_id = s.c_id
group by c.c_id   -- è¯¾ç¨‹åˆ†ç»„
order by 3 desc;  -- é™åº
```

![](https://tva1.sinaimg.cn/large/0081Kckwgy1gkuweo5gxjj31060oqgou.jpg)



### é¢˜ç›®22

![](https://tva1.sinaimg.cn/large/0081Kckwgy1gkgmq9quckj31d20gu0wv.jpg)

#### é¢˜ç›®éœ€æ±‚

æŸ¥è¯¢æ‰€æœ‰è¯¾ç¨‹çš„æˆç»©ç¬¬2ååˆ°ç¬¬3åçš„å­¦ç”Ÿä¿¡æ¯åŠè¯¥è¯¾ç¨‹æˆç»©

#### åˆ†æè¿‡ç¨‹

æˆç»©ï¼šScore

å­¦ç”Ÿä¿¡æ¯ï¼šStudent

**æˆ‘ä»¬é€šè¿‡å–å‡ºæ¯ç§‘çš„ç¬¬2ã€3åæ‹¼æ¥èµ·æ¥å†å–å‡ºå­¦ç”Ÿä¿¡æ¯**

#### SQLå®ç°

##### è‡ªå·±çš„æ–¹æ³•

1ã€è¯¾ç¨‹è¡¨å’Œæˆç»©è¡¨è¿æ¥èµ·æ¥ï¼Œæ˜¾ç¤ºæ‰€æœ‰çš„è¯¾ç¨‹å’Œæˆç»©ä¿¡æ¯

```sql
select
	s.s_id
	,s.c_id
	,s.s_score
	,c.c_name
from Score s
join Course c
on s.c_id = c.c_id
```

![](https://tva1.sinaimg.cn/large/0081Kckwgy1gkuwq7p3u0j30nc13gdk1.jpg)

2ã€æŸ¥å‡ºå…¨éƒ¨çš„è¯­æ–‡æˆç»©

```sql
select s.s_id, s.s_score, c.c_name
from Score s
join Course c on s.c_id = c.c_id
where c.c_name = 'è¯­æ–‡'
order by s.s_score desc;
```

![](https://tva1.sinaimg.cn/large/0081Kckwgy1gkuwycg0hkj30sg0kwjtj.jpg)

3ã€æˆ‘ä»¬æ‰¾å‡ºè¯­æ–‡çš„ç¬¬2ã€3çš„å­¦ç”Ÿ

```sql
select s.s_id, s.s_score, c.c_name
from Score s
join Course c on s.c_id = c.c_id
where c.c_name = 'è¯­æ–‡'
order by s.s_score desc
limit 1, 2;
```

![](https://tva1.sinaimg.cn/large/0081Kckwgy1gkux0xrf1qj30so0hkmzh.jpg)

4ã€åŒæ—¶æ±‚å‡ºè¯­æ–‡ã€æ•°å­¦ã€è‹±è¯­çš„åˆ†æ•°ï¼Œå¹¶ä¸”é€šè¿‡`union`æ‹¼æ¥

```sql
-- unionè¿æ¥

(select s.s_id, s.s_score, c.c_name
from Score s
join Course c on s.c_id = c.c_id
where c.c_name = 'è¯­æ–‡'
order by s.s_score desc
limit 1, 2)

union

(select s.s_id, s.s_score, c.c_name
from Score s
join Course c on s.c_id = c.c_id
where c.c_name = 'æ•°å­¦'
order by s.s_score desc
limit 1, 2)

union
((select s.s_id, s.s_score, c.c_name
from Score s
join Course c on s.c_id = c.c_id
where c.c_name = 'è‹±è¯­'
order by s.s_score desc
limit 1, 2))
```

![](https://tva1.sinaimg.cn/large/0081Kckwgy1gkux41350mj30go0dwdgz.jpg)

5ã€å°†ä¸Šé¢çš„ç»“æœå­¦ç”Ÿä¿¡æ¯è¡¨è¿›è¡Œè¿æ¥å³å¯

å¥½æ­¹æ˜¯å®ç°äº†ğŸ˜­

```sql
-- æœ€ç»ˆè„šæœ¬
-- ï¼ï¼ï¼ï¼çœŸçš„éœ€è¦å¥½å¥½ä¼˜åŒ–ä¸‹

select
	s.s_id
	,s.s_name
	,t.c_name
	,t.s_score
from Student s
join (-- unionè¿æ¥

(select s.s_id, s.s_score, c.c_name
from Score s
join Course c on s.c_id = c.c_id
where c.c_name = 'è¯­æ–‡'
order by s.s_score desc
limit 1, 2)

union

(select s.s_id, s.s_score, c.c_name
from Score s
join Course c on s.c_id = c.c_id
where c.c_name = 'æ•°å­¦'
order by s.s_score desc
limit 1, 2)

union
((select s.s_id, s.s_score, c.c_name
from Score s
join Course c on s.c_id = c.c_id
where c.c_name = 'è‹±è¯­'
order by s.s_score desc
limit 1, 2)))t  -- ä¸´æ—¶è¡¨t

on s.s_id = t.s_id
```

![](https://tva1.sinaimg.cn/large/0081Kckwgy1gkux8eb5j1j30lm0e60ua.jpg)

##### å’Œç¬¬25é¢˜ç›¸åŒçš„æ–¹æ³•

1ã€ä»¥è¯­æ–‡ä¸ºä¾‹ï¼Œé¦–å…ˆæˆ‘ä»¬æ‰¾å‡ºå‰3åçš„æˆç»©ï¼ˆåŒ…å«ç›¸åŒçš„æˆç»©ï¼‰

```sql
-- è¯­æ–‡
select
	a.s_id
	,a.c_id
	,a.s_score   -- 3ã€æ­¤æ—¶aè¡¨çš„æˆç»©å°±æ˜¯æˆ‘ä»¬æ‰¾çš„
from Score a
join Score b
on a.c_id = b.c_id
and a.s_score <= b.s_score  -- 1ã€åˆ¤æ–­açš„åˆ†æ•°å°äºç­‰äºbçš„åˆ†æ•°ï¼Œè¦å¸¦ä¸Šç­‰å·
and a.c_id="01"
group by 1,2
having count(b.s_id) <= 3  -- 2ã€bä¸­çš„ä¸ªæ•°è‡³å°‘æœ‰3ä¸ªï¼Œåº”å¯¹åˆ†æ•°ç›¸åŒçš„æƒ…å½¢
order by 3 desc
limit 1,2
```

![](https://tva1.sinaimg.cn/large/0081Kckwgy1gkwxbcajh7j317c0nedjj.jpg)

```sql
-- è¯­æ–‡
select
	a.s_id
	,a.c_id
	,a.s_score   -- 3ã€æ­¤æ—¶aè¡¨çš„æˆç»©å°±æ˜¯æˆ‘ä»¬æ‰¾çš„
from Score a
join Score b
on a.c_id = b.c_id
and a.s_score <= b.s_score  -- 1ã€åˆ¤æ–­açš„åˆ†æ•°å°äºç­‰äºbçš„åˆ†æ•°ï¼Œè¦å¸¦ä¸Šç­‰å·
and a.c_id="01"
group by 1,2
having count(b.s_id) <= 3  -- 2ã€bä¸­çš„ä¸ªæ•°è‡³å°‘æœ‰3ä¸ªï¼Œåº”å¯¹åˆ†æ•°ç›¸åŒçš„æƒ…å½¢
order by 3 desc
limit 1,2;   -- å–å¾—ç¬¬2ã€3å
```

åœ¨é€šè¿‡æ•°å­¦å’Œè‹±è¯­çš„ç±»ä¼¼æ“ä½œå¾—åˆ°2ã€3åçš„æˆç»©ï¼Œå†è¿›è¡Œæ‹¼æ¥å³å¯

### é¢˜ç›®23

#### é¢˜ç›®éœ€æ±‚

ç»Ÿè®¡å„ç§‘æˆç»©å„åˆ†æ•°æ®µäººæ•°ï¼šè¯¾ç¨‹ç¼–å·ï¼Œè¯¾ç¨‹åç§°ï¼Œ[100-85]ï¼Œ[85-70]ï¼Œ[70-60]ï¼Œ[0-60]åŠæ‰€å ç™¾åˆ†æ¯”

![](https://tva1.sinaimg.cn/large/0081Kckwgy1gkgmq9quckj31d20gu0wv.jpg)

#### åˆ†æè¿‡ç¨‹

è¯¾ç¨‹ï¼šCourse

æˆç»©ï¼šScore

é€šè¿‡caseè¯­å¥æ¥è¿›è¡Œåˆ¤æ–­ï¼Œcountè¯­å¥è¿›è¡Œç»Ÿè®¡ï¼Œsumè¯­å¥è¿›è¡Œæ±‚å’Œ



#### SQLå®ç°

##### è‡ªå·±çš„æ–¹æ³•

1ã€å¦‚ä½•å¯¹æ¯ä¸ªæˆç»©è¿›è¡Œåˆ†ç»„å±•ç¤ºï¼šABCDä»£è¡¨ç›¸åº”çš„ç­‰çº§

```sql
select
	c_id
	,s_score
	,case when s_score >= 85 and  s_score<= 100 then 'A'   -- å¤§å°å…³ç³»å¿…é¡»åˆ†ä¸¤æ¬¡å†™ï¼Œä¸€æ¬¡å†™çš„è¯MySQLæ— æ³•è¯†åˆ«
		when 70 <= s_score and s_score < 85 then 'B'
		when 60 <= s_score and s_score < 70 then 'C'
		when 0 <= s_score and s_score < 60 then 'D'
		else 'å…¶ä»–' end as 'category'
from Score s;
```

![](https://tva1.sinaimg.cn/large/0081Kckwgy1gkvuafu8bij30ks0tojtj.jpg)

2ã€å°†ä¸¤ä¸ªè¡¨å…³è”èµ·æ¥å±•ç¤ºæ•°æ®

```sql
-- 1ã€æŸ¥çœ‹å…¨éƒ¨è¯¾ç¨‹å’Œæˆç»©ä¿¡æ¯

select
	s.c_id
	,c.c_name
	,s.s_score
	,case when s.s_score >= 85 and  s.s_score<= 100 then 'A'   -- å¤§å°å…³ç³»å¿…é¡»åˆ†ä¸¤æ¬¡å†™ï¼Œä¸€æ¬¡å†™çš„è¯MySQLæ— æ³•è¯†åˆ«
		when 70 <= s.s_score and s.s_score < 85 then 'B'
		when 60 <= s.s_score and s.s_score < 70 then 'C'
		when 0 <= s.s_score and s.s_score < 60 then 'D'
		else 'å…¶ä»–' end as 'category'
from Score s
join Course c
on s.c_id = c.c_id;
```

![](https://tva1.sinaimg.cn/large/0081Kckwgy1gkwkyohk2sj30mw0rsad7.jpg)

3ã€å®Œæ•´ä»£ç 

```sql
select
	s.c_id  ç¼–å·
	,c.c_name  ç§‘ç›®
	,sum(case when s.s_score >= 85 and  s.s_score<= 100 then 1 else 0 end) "[85,100]äººæ•°"
	,round(100 * (sum(case when s.s_score >= 85 and  s.s_score<= 100 then 1 else 0 end) / sum(case when s.s_score then 1 else 0 end)), 2) as '[85,100]ç™¾åˆ†æ¯”'
	,sum(case when s.s_score >= 70 and  s.s_score<= 85 then 1 else 0 end) "[70,85]äººæ•°"
	,round(100 * (sum(case when s.s_score >= 70 and  s.s_score<= 85 then 1 else 0 end) / sum(case when s.s_score then 1 else 0 end)), 2) as '[70,85]ç™¾åˆ†æ¯”'
	,sum(case when s.s_score >= 60 and  s.s_score<= 70 then 1 else 0 end) "[60,70]äººæ•°"
	,round(100 * (sum(case when s.s_score >= 60 and  s.s_score<= 70 then 1 else 0 end) / sum(case when s.s_score then 1 else 0 end)), 2) as '[60,70]ç™¾åˆ†æ¯”'
	,sum(case when s.s_score >= 0 and  s.s_score<= 60 then 1 else 0 end) "[0,60]äººæ•°"
	,round(100 * (sum(case when s.s_score >= 0 and  s.s_score<= 60 then 1 else 0 end) / sum(case when s.s_score then 1 else 0 end)), 2) as '[0,60]ç™¾åˆ†æ¯”'
from Score s
left join Course c
on s.c_id = c.c_id
group by s.c_id, c.c_name
```

![](https://tva1.sinaimg.cn/large/0081Kckwgy1gkwlipsol2j320a0nidlm.jpg)



##### å‚è€ƒæ–¹æ³•

1ã€å…ˆç»Ÿè®¡æ¯ä¸ªé˜¶æ®µçš„äººæ•°å’Œå æ¯”

```sql
select
	c_id
	,sum(case when s_score > 85 and s_score <=100 then 1 else 0 end) as '85-100'
	,round(100 * (sum(case when s_score > 85 and s_score <= 100 then 1 else 0 end) / count(*)), 2) 'å æ¯”'
from Score
group by c_id;  -- åˆ†è¯¾ç¨‹ç»Ÿè®¡æ€»æ•°å’Œå æ¯”


-- æ–¹å¼2
select
	c_id
	,sum(case when s_score > 85 and s_score <=100 then 1 else 0 end) as '85-100'
	,round(100 * (sum(case when s_score > 85 and s_score <= 100 then 1 else 0 end) / count(case when s_score then 1 else 0 end)), 2) 'å æ¯”'   -- ä¸åŒcount(*)
from Score
group by c_id;
```

![](https://tva1.sinaimg.cn/large/0081Kckwgy1gkwlwpoh9cj31oq0iidi9.jpg)

æ³¨æ„å¯¹æ¯”ï¼š

![](https://tva1.sinaimg.cn/large/0081Kckwgy1gkwlz17vvlj327e0k6whe.jpg)

2ã€æˆ‘ä»¬å°†4ç§æƒ…å†µåŒæ—¶æŸ¥å‡ºæ¥

```sql
select
	c_id
	,sum(case when s_score > 85 and s_score <=100 then 1 else 0 end) as '85-100'
	,round(100 * (sum(case when s_score > 85 and s_score <= 100 then 1 else 0 end) / count(*)), 2) '[85,100]å æ¯”'
	,sum(case when s_score > 70 and s_score <=85 then 1 else 0 end) as '70-85'
	,round(100 * (sum(case when s_score > 70 and s_score <= 85 then 1 else 0 end) / count(*)), 2) '[70,85]å æ¯”'
	,sum(case when s_score > 60 and s_score <=70 then 1 else 0 end) as '60-70'
	,round(100 * (sum(case when s_score > 60 and s_score <= 70 then 1 else 0 end) / count(*)), 2) '[60,70]å æ¯”'
	,sum(case when s_score >=0 and s_score <=60 then 1 else 0 end) as '0-60'
	,round(100 * (sum(case when s_score > 0 and s_score <= 60 then 1 else 0 end) / count(*)), 2) '[0,60]å æ¯”'
from Score
group by c_id;  -- åˆ†è¯¾ç¨‹ç»Ÿè®¡æ€»æ•°å’Œå æ¯”
```

![](https://tva1.sinaimg.cn/large/0081Kckwgy1gkwmb3rbozj31ni0o0jwb.jpg)

3ã€å°†ç§‘ç›®åç§°è¿æ¥èµ·æ¥

```sql
-- æ•´ä½“å’Œè‡ªå·±çš„æ–¹æ³•æ˜¯ç±»ä¼¼çš„
select
	s.c_id
	,c.c_name
	,sum(case when s_score > 85 and s_score <=100 then 1 else 0 end) as '85-100'
	,round(100 * (sum(case when s_score > 85 and s_score <= 100 then 1 else 0 end) / count(*)), 2) '[85,100]å æ¯”'
	,sum(case when s_score > 70 and s_score <=85 then 1 else 0 end) as '70-85'
	,round(100 * (sum(case when s_score > 70 and s_score <= 85 then 1 else 0 end) / count(*)), 2) '[70,85]å æ¯”'
	,sum(case when s_score > 60 and s_score <=70 then 1 else 0 end) as '60-70'
	,round(100 * (sum(case when s_score > 60 and s_score <= 70 then 1 else 0 end) / count(*)), 2) '[60,70]å æ¯”'
	,sum(case when s_score >=0 and s_score <=60 then 1 else 0 end) as '0-60'
	,round(100 * (sum(case when s_score > 0 and s_score <= 60 then 1 else 0 end) / count(*)), 2) '[0,60]å æ¯”'
from Score s
left join Course c
on s.c_id = c.c_id
group by s.c_id, c.c_name;    -- åˆ†è¯¾ç¨‹ç»Ÿè®¡æ€»æ•°å’Œå æ¯”
```

![](https://tva1.sinaimg.cn/large/0081Kckwgy1gkwmfpko5kj31my0rcdlj.jpg)



### é¢˜ç›®24

#### é¢˜ç›®éœ€æ±‚

æŸ¥è¯¢å­¦ç”Ÿçš„å¹³å‡æˆç»©åŠåæ¬¡

#### åˆ†æè¿‡ç¨‹

å­¦ç”Ÿï¼šStudent

æˆç»©ï¼šScore

å¹³å‡ï¼šavgå‡½æ•°

åæ¬¡ï¼šé€šè¿‡æ’åºæ¥è§£å†³

#### SQLå®ç°

##### è‡ªå·±çš„æ–¹æ³•

1ã€å…ˆæ±‚å‡ºæ¯ä¸ªäººçš„å¹³å‡åˆ†

```sql
-- è‡ªå·±çš„æ–¹æ³•

select
	sc.s_id
	,s.s_name
	,round(avg(sc.s_score),2)  avg_score
from Score sc
join Student s
on sc.s_id=s.s_id
group by sc.s_id,s.s_name
```

![](https://tva1.sinaimg.cn/large/0081Kckwgy1gkwmrdth8yj30pq0nkdi7.jpg)

2ã€æˆ‘ä»¬å¯¹ä¸Šé¢çš„ç»“æœè¿›è¡Œæ’åº

ï¼ï¼ï¼**MySQL5ä¸­æ˜¯æ²¡æœ‰rankå‡½æ•°çš„ï¼Œéœ€è¦è‡ªå·±å®ç°æ’åºåŠŸèƒ½**

```sql
-- MYSQL5.7ä¸­æ²¡æœ‰rankå‡½æ•°ï¼Œæ‰€ä»¥é€šè¿‡è‡ªè¿æ¥å®ç°

select
	t1.s_id
	,t1.s_name
	,t1.avg_score
	,(select count(distinct t2.avg_score)
		from (select
            sc.s_id
            ,s.s_name
            ,round(avg(sc.s_score),2)  avg_score
          from Score sc
          join Student s
          on sc.s_id=s.s_id
          group by sc.s_id,s.s_name)t2    -- ä¸´æ—¶è¡¨t2ä¹Ÿæ˜¯ä¸Šé¢çš„ç»“æœ
		where t2.avg_score >= t1.avg_score
		) rank

from (select
        sc.s_id
        ,s.s_name
        ,round(avg(sc.s_score),2)  avg_score
      from Score sc
      join Student s
      on sc.s_id=s.s_id
      group by sc.s_id,s.s_name)t1   -- ä¸´æ—¶è¡¨t1å°±æ˜¯ä¸Šé¢çš„ç»“æœ
order by t1.avg_score desc;
```

![](https://tva1.sinaimg.cn/large/0081Kckwgy1gkwn5atqzsj30my0ee75l.jpg)

##### å‚è€ƒæ–¹æ³•

```sql
select
	a.s_id  -- å­¦å·
	,@i:=@i+1 as 'ä¸ä¿ç•™ç©ºç¼ºæ’å'   -- ç›´æ¥içš„è‡ªåŠ 
	,@k:=(case when @avg_score=a.avg_s then @k else @i end) as 'ä¿ç•™ç©ºç¼ºæ’å'
	,@avg_score:=avg_s as 'å¹³å‡åˆ†'  -- è¡¨aä¸­çš„å€¼

from (select
      	s_id
      	,round(avg(s_score), 2) as avg_s
      from Score
      group by s_id
      order by 2 desc)a    -- è¡¨aï¼šå¹³å‡æˆç»©çš„æ’åºå’Œå­¦å·
      ,(select @avg_score:=0, @i:=0, @k:=0)b   -- è¡¨bï¼šé€šè¿‡å˜é‡è®¾ç½®åˆå§‹å€¼
```

![](https://tva1.sinaimg.cn/large/0081Kckwgy1gkwuk9x958j31860teq6t.jpg)

### å®ç°rankå‡½æ•°

```sql
select
	s.s_name  -- å§“å
	,s.s_score  -- æˆç»©
	,(select count(distinct t2.s_score)
    from Score t2
    where t2.s_score >= t1.s_score) rank   -- åœ¨t2åˆ†æ•°å¤§çš„æƒ…å†µä¸‹ï¼Œç»Ÿè®¡t2çš„å»é‡ä¸ªæ•°
from Score t1
order by t1.s_score desc;   -- åˆ†æ•°é™åºæ’åˆ—
```

ä¸¾ä¾‹å­æ¥è¯´æ˜è¿™ä¸ªè„šæœ¬ï¼š

| å§“å | æˆç»© |
| ---- | ---- |
| å¼ ä¸‰ | 89   |
| æå›› | 90   |
| ç‹äº” | 78   |
| å°æ˜ | 98   |
| å°çº¢ | 60   |

1. å½“t1.s_score=89ï¼Œæ»¡è¶³t2.s_score > = t1.s_scoreçš„æœ‰**98ï¼Œ90å’Œ89**ï¼Œæ­¤æ—¶count(distinct t2.s_score) çš„ä¸ªæ•°å°±æ˜¯3
2. å½“t1.s_score=90ï¼Œæ»¡è¶³t2.s_score > = t1.s_scoreçš„æœ‰**98å’Œ90**ï¼Œæ­¤æ—¶count(distinct t2.s_score) çš„ä¸ªæ•°å°±æ˜¯2
3. å½“t1.s_score=78ï¼Œæ»¡è¶³t2.s_score > = t1.s_scoreçš„æœ‰**98ã€90ã€89å’Œ78**ï¼Œæ­¤æ—¶count(distinct t2.s_score) çš„ä¸ªæ•°å°±æ˜¯4
4. å½“t1.s_score=98ï¼Œæ»¡è¶³t2.s_score > = t1.s_scoreçš„åªæœ‰**98**ï¼Œæ­¤æ—¶count(distinct t2.s_score) çš„ä¸ªæ•°å°±æ˜¯1
5. å½“t1.s_score=60ï¼Œæ»¡è¶³t2.s_score > = t1.s_scoreçš„**æœ‰89ã€90ã€78ã€98ã€60**ï¼Œæ­¤æ—¶count(distinct t2.s_score) çš„ä¸ªæ•°å°±æ˜¯5

é€šè¿‡ä¸Šé¢çš„æ­¥éª¤ï¼Œæˆ‘ä»¬å‘ç°ï¼š**t1ä¸­æ¯ä¸ªåˆ†æ•°å¯¹åº”çš„ä¸ªæ•°å°±æ˜¯å®ƒçš„æ’å**

### é¢˜ç›®25

![](https://tva1.sinaimg.cn/large/0081Kckwgy1gkgmq9quckj31d20gu0wv.jpg)

#### é¢˜ç›®éœ€æ±‚

æŸ¥è¯¢å„ç§‘æˆç»©å‰ä¸‰åçš„è®°å½•

#### åˆ†æè¿‡ç¨‹

è¿™é¢˜å’Œç¬¬22é¢˜æ˜¯å±äºä¸€ä¸ªç±»å‹çš„ï¼šæ‰¾åˆ°æ¯ä¸ªç§‘ç›®çš„æŒ‡å®šåæ¬¡çš„æˆç»©ï¼Œä½¿ç”¨çš„è¡¨æ˜¯ï¼š`Score`

#### SQLå®ç°

##### è‡ªå·±çš„æ–¹æ³•

1ã€é¦–å…ˆæˆ‘ä»¬æ‰¾å‡ºè¯­æ–‡çš„å‰3å

```sql
select s.s_id, s.s_score, c.c_name
from Score s
join Course c on s.c_id = c.c_id
where c.c_name = 'è¯­æ–‡'
order by s.s_score desc   -- é™åºä¹‹åå–å‡ºå‰3æ¡è®°å½•
limit 3;
```

![](https://tva1.sinaimg.cn/large/0081Kckwgy1gkwv06hl7ij30o20k6q4w.jpg)

![](https://tva1.sinaimg.cn/large/0081Kckwgy1gkwv0wa0wuj30wk0gydhw.jpg)

2ã€é€šè¿‡åŒæ ·çš„æ–¹æ³•æˆ‘ä»¬å¯ä»¥æ±‚å‡ºæ•°å­¦å’Œè‹±è¯­çš„å‰3æ¡è®°å½•ï¼Œç„¶åé€šè¿‡unionè¿›è¡Œè”ç»“ï¼Œæœ‰å¾…ä¼˜åŒ–ğŸ˜­

```sql
-- è‡ªå·±çš„è„šæœ¬

(select s.s_id, s.s_score, c.c_name
from Score s
join Course c on s.c_id = c.c_id
where c.c_name = 'è¯­æ–‡'
order by s.s_score desc   -- é™åºä¹‹åå–å‡ºå‰3æ¡è®°å½•
limit 3)

union

(select s.s_id, s.s_score, c.c_name
from Score s
join Course c on s.c_id = c.c_id
where c.c_name = 'æ•°å­¦'
order by s.s_score desc
limit 3)

union

(select s.s_id, s.s_score, c.c_name
from Score s
join Course c on s.c_id = c.c_id
where c.c_name = 'è‹±è¯­'
order by s.s_score desc
limit 3)
```

![](https://tva1.sinaimg.cn/large/0081Kckwgy1gkwv4byilcj30tw18i0xn.jpg)

##### å‚è€ƒæ–¹æ³•

é€šè¿‡Scoreè¡¨çš„è‡ªè¿æ¥ï¼Œè¡¨aä¸­çš„å€¼å°äºè¡¨bä¸­çš„å€¼ï¼Œæ’åºä¹‹åæˆ‘ä»¬å–å‰3

```sql
select
	a.s_id
	,a.c_id
	,a.s_score   -- å–å‡ºaä¸­çš„æˆç»©
from Score a
join Score b
on a.c_id = b.c_id
and a.s_score <= b.s_score   -- è¡¨bä¸­çš„æˆç»©å¤§
group by 1,2,3
having count(b.s_id) = 3
order by 2, 3 desc;
```

æˆ‘ä»¬é€šè¿‡`è¯­æ–‡`è¿™ä¸ªç§‘ç›®æ¥ç†è§£ä¸Šé¢çš„ä»£ç ï¼š**å‰3åæ˜¯80ï¼Œ80ï¼Œ76**

![](https://tva1.sinaimg.cn/large/0081Kckwgy1gkwwf45tgmj30pm0egwfo.jpg)

```sql
-- è¯­æ–‡
select
	a.s_id
	,a.c_id
	,a.s_score   -- 3ã€æ­¤æ—¶aè¡¨çš„æˆç»©å°±æ˜¯æˆ‘ä»¬æ‰¾çš„
from Score a
join Score b
on a.c_id = b.c_id
and a.s_score <= b.s_score  -- 1ã€åˆ¤æ–­açš„åˆ†æ•°å°äºç­‰äºbçš„åˆ†æ•°ï¼Œè¦å¸¦ä¸Šç­‰å·
and a.c_id="01"
group by 1,2
having count(b.s_id) <= 3  -- 2ã€bä¸­çš„ä¸ªæ•°è‡³å°‘æœ‰3ä¸ªï¼Œåº”å¯¹åˆ†æ•°ç›¸åŒçš„æƒ…å½¢
order by 3 desc;
```

![](https://tva1.sinaimg.cn/large/0081Kckwgy1gkwww41mkdj30ou0notaw.jpg)

```sql
-- è¯­æ–‡

select
	a.s_id
	,a.c_id
	,a.s_score   -- aè¡¨çš„æˆç»©
from Score a
join Score b
on a.c_id = b.c_id
and a.s_score <= b.s_score   -- 1ã€åˆ¤æ–­açš„åˆ†æ•°å°äºç­‰äºbçš„åˆ†æ•°ï¼Œè¦å¸¦ä¸Šç­‰å·
group by 1,2,3
having count(b.s_id) <= 3   -- 2ã€bä¸­çš„ä¸ªæ•°è‡³å°‘æœ‰3ä¸ªï¼Œåº”å¯¹åˆ†æ•°ç›¸åŒçš„æƒ…å½¢
order by 2, 3 desc;   -- è¯¾ç¨‹ï¼ˆ2ï¼‰çš„å‡åºï¼Œæˆç»©ï¼ˆï¼‰3çš„é™åº
```

![](https://tva1.sinaimg.cn/large/0081Kckwgy1gkwx01p0fvj31160t6gou.jpg)
